# ç”Ÿèœå¥åº·çŠ¶æ€åˆ†å‰²ç³»ç»Ÿæºç ï¼†æ•°æ®é›†åˆ†äº«
 [yolov8-seg-C2f-DWRï¼†yolov8-seg-C2f-DLKAç­‰50+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_ä¸€é”®è®­ç»ƒæ•™ç¨‹_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[ILSVRC ImageNet Large Scale Visual Recognition Challenge](https://gitee.com/YOLOv8_YOLOv11_Segmentation_Studio/projects)

é¡¹ç›®æ¥æº[AAAI Global Al lnnovation Contest](https://kdocs.cn/l/cszuIiCKVNis)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€å…¨çƒäººå£çš„ä¸æ–­å¢é•¿å’ŒåŸå¸‚åŒ–è¿›ç¨‹çš„åŠ å¿«ï¼Œå†œä¸šç”Ÿäº§é¢ä¸´ç€å‰æ‰€æœªæœ‰çš„æŒ‘æˆ˜ã€‚å°¤å…¶æ˜¯åœ¨è”¬èœç§æ¤é¢†åŸŸï¼Œå¦‚ä½•æé«˜ä½œç‰©çš„äº§é‡å’Œè´¨é‡ï¼Œä¿éšœé£Ÿå“å®‰å…¨ï¼Œæˆä¸ºäº†äºŸå¾…è§£å†³çš„é—®é¢˜ã€‚ç”Ÿèœä½œä¸ºä¸€ç§å¹¿æ³›ç§æ¤å’Œæ¶ˆè´¹çš„å¶èœç±»è”¬èœï¼Œå…¶å¥åº·çŠ¶æ€ç›´æ¥å½±å“åˆ°äº§é‡å’Œå¸‚åœºä»·å€¼ã€‚å› æ­¤ï¼Œå¼€å‘ä¸€ç§é«˜æ•ˆã€å‡†ç¡®çš„ç”Ÿèœå¥åº·çŠ¶æ€ç›‘æµ‹ç³»ç»Ÿï¼Œå¯¹äºæå‡å†œä¸šç”Ÿäº§æ•ˆç‡ã€å‡å°‘èµ„æºæµªè´¹ã€ä¿éšœé£Ÿå“å®‰å…¨å…·æœ‰é‡è¦çš„ç°å®æ„ä¹‰ã€‚

è¿‘å¹´æ¥ï¼Œè®¡ç®—æœºè§†è§‰æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ä¸ºå†œä¸šæ™ºèƒ½åŒ–æä¾›äº†æ–°çš„è§£å†³æ–¹æ¡ˆã€‚å°¤å…¶æ˜¯åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹ä¸åˆ†å‰²æŠ€æœ¯ï¼Œå·²ç»åœ¨å¤šä¸ªé¢†åŸŸå–å¾—äº†æ˜¾è‘—çš„æˆæœã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹ä»¥å…¶é«˜æ•ˆçš„å®æ—¶æ£€æµ‹èƒ½åŠ›å’Œè‰¯å¥½çš„å‡†ç¡®æ€§ï¼Œæˆä¸ºäº†ç›®æ ‡æ£€æµ‹é¢†åŸŸçš„ä½¼ä½¼è€…ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„æ€§èƒ½ï¼Œå°¤å…¶åœ¨å¤„ç†å¤æ‚åœºæ™¯å’Œå°ç›®æ ‡æ£€æµ‹æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚å› æ­¤ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„ç”Ÿèœå¥åº·çŠ¶æ€åˆ†å‰²ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰æŠ€æœ¯ä¸Šçš„åˆ›æ–°æ€§ï¼Œä¹Ÿä¸ºå†œä¸šç”Ÿäº§æä¾›äº†åˆ‡å®å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚

æœ¬ç ”ç©¶æ‰€ä½¿ç”¨çš„æ•°æ®é›†åŒ…å«1500å¼ ç”Ÿèœå›¾åƒï¼Œæ¶µç›–äº†7ä¸ªç±»åˆ«ï¼ŒåŒ…æ‹¬å¥åº·ç”Ÿèœã€ä¸åŒç”Ÿé•¿é˜¶æ®µçš„ç”Ÿèœä»¥åŠç”Ÿèœçš„ç—…å®³çŠ¶æ€ï¼ˆå¦‚Tipburnï¼‰ã€‚è¿™äº›æ•°æ®çš„å¤šæ ·æ€§å’Œä¸°å¯Œæ€§ä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†è‰¯å¥½çš„åŸºç¡€ã€‚é€šè¿‡å¯¹è¿™äº›å›¾åƒè¿›è¡Œå®ä¾‹åˆ†å‰²ï¼Œå¯ä»¥ç²¾ç¡®è¯†åˆ«å’Œåˆ†ç±»ä¸åŒå¥åº·çŠ¶æ€çš„ç”Ÿèœï¼Œä¸ºåç»­çš„ç—…å®³ç›‘æµ‹å’Œç”Ÿé•¿é˜¶æ®µè¯„ä¼°æä¾›é‡è¦ä¾æ®ã€‚è¿™ä¸€è¿‡ç¨‹ä¸ä»…èƒ½å¤Ÿå¸®åŠ©å†œæ°‘åŠæ—¶å‘ç°å’Œå¤„ç†ç—…å®³ï¼Œå‡å°‘æŸå¤±ï¼Œè¿˜èƒ½ä¸ºå†œä¸šç®¡ç†å†³ç­–æä¾›æ•°æ®æ”¯æŒï¼Œæå‡æ•´ä½“ç”Ÿäº§æ•ˆç‡ã€‚

æ­¤å¤–ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„ç”Ÿèœå¥åº·çŠ¶æ€åˆ†å‰²ç³»ç»Ÿçš„ç ”ç©¶ï¼Œè¿˜å…·æœ‰é‡è¦çš„ç¤¾ä¼šæ„ä¹‰ã€‚éšç€æ¶ˆè´¹è€…å¯¹é£Ÿå“å®‰å…¨å’Œå¥åº·çš„å…³æ³¨åº¦æ—¥ç›Šæé«˜ï¼Œå¦‚ä½•ç¡®ä¿æ‰€è´­ç”Ÿèœçš„è´¨é‡å’Œå®‰å…¨æ€§ï¼Œæˆä¸ºäº†æ¶ˆè´¹è€…å…³å¿ƒçš„ç„¦ç‚¹ã€‚é€šè¿‡å¼•å…¥å…ˆè¿›çš„è®¡ç®—æœºè§†è§‰æŠ€æœ¯ï¼Œèƒ½å¤Ÿå®ç°å¯¹ç”Ÿèœå¥åº·çŠ¶æ€çš„å®æ—¶ç›‘æµ‹ï¼Œæå‡ç”Ÿèœçš„è´¨é‡æ§åˆ¶æ°´å¹³ï¼Œè¿›è€Œå¢å¼ºæ¶ˆè´¹è€…çš„ä¿¡ä»»æ„Ÿï¼Œä¿ƒè¿›ç”Ÿèœå¸‚åœºçš„å¥åº·å‘å±•ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„ç”Ÿèœå¥åº·çŠ¶æ€åˆ†å‰²ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…æ˜¯å¯¹è®¡ç®—æœºè§†è§‰æŠ€æœ¯åœ¨å†œä¸šé¢†åŸŸåº”ç”¨çš„æ¢ç´¢ï¼Œæ›´æ˜¯å¯¹æé«˜å†œä¸šç”Ÿäº§æ•ˆç‡ã€ä¿éšœé£Ÿå“å®‰å…¨çš„é‡è¦å®è·µã€‚é€šè¿‡è¯¥ç³»ç»Ÿçš„å¼€å‘ä¸åº”ç”¨ï¼ŒæœŸæœ›èƒ½å¤Ÿä¸ºç°ä»£å†œä¸šçš„æ™ºèƒ½åŒ–å‘å±•æä¾›æ–°çš„æ€è·¯å’Œæ–¹æ³•ï¼Œæ¨åŠ¨å†œä¸šç”Ÿäº§çš„å¯æŒç»­å‘å±•ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1TfmvYTEPS/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 2
names: ['Healthy Lettuce', 'Tipburn']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†åä¸ºâ€œcapstone1-2â€çš„æ•°æ®é›†ï¼Œä»¥è®­ç»ƒå’Œæ”¹è¿›YOLOv8-segæ¨¡å‹ï¼Œæ—¨åœ¨å®ç°ç”Ÿèœå¥åº·çŠ¶æ€çš„ç²¾ç¡®åˆ†å‰²ã€‚è¯¥æ•°æ®é›†ä¸“æ³¨äºç”Ÿèœçš„å¥åº·çŠ¶å†µï¼Œç‰¹åˆ«æ˜¯åŒºåˆ†å¥åº·ç”Ÿèœä¸å› ç¯å¢ƒå› ç´ å¯¼è‡´çš„â€œTipburnâ€ç—…ç—‡ã€‚æ•°æ®é›†çš„è®¾è®¡è€ƒè™‘åˆ°äº†ç”Ÿèœåœ¨ä¸åŒç”Ÿé•¿é˜¶æ®µå’Œç¯å¢ƒæ¡ä»¶ä¸‹çš„è¡¨ç°ï¼Œç¡®ä¿äº†æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„æœ‰æ•ˆæ€§å’Œé²æ£’æ€§ã€‚

â€œcapstone1-2â€æ•°æ®é›†åŒ…å«ä¸¤ä¸ªä¸»è¦ç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯â€œHealthy Lettuceâ€å’Œâ€œTipburnâ€ã€‚â€œHealthy Lettuceâ€ç±»åˆ«ä»£è¡¨äº†ç”Ÿèœåœ¨æœ€ä½³ç”Ÿé•¿æ¡ä»¶ä¸‹çš„çŠ¶æ€ï¼Œå…·æœ‰é²œäº®çš„ç»¿è‰²å’Œå‡åŒ€çš„å¶ç‰‡ç»“æ„ï¼Œè±¡å¾ç€è‰¯å¥½çš„ç”Ÿé•¿ç¯å¢ƒå’Œå¥åº·çš„æ¤ç‰©ç”Ÿç†çŠ¶æ€ã€‚æ­¤ç±»åˆ«çš„æ•°æ®æ ·æœ¬ä¸ä»…æ¶µç›–äº†ä¸åŒå“ç§çš„ç”Ÿèœï¼Œè¿˜åŒ…æ‹¬äº†åœ¨ä¸åŒå…‰ç…§ã€æ¹¿åº¦å’Œæ¸©åº¦æ¡ä»¶ä¸‹æ‹æ‘„çš„å›¾åƒï¼Œä»¥å¢å¼ºæ¨¡å‹å¯¹å¥åº·ç”Ÿèœç‰¹å¾çš„å­¦ä¹ èƒ½åŠ›ã€‚

å¦ä¸€æ–¹é¢ï¼Œâ€œTipburnâ€ç±»åˆ«åˆ™èšç„¦äºç”Ÿèœåœ¨é­å—ç”Ÿç†æ€§ç—…å®³æ—¶çš„è¡¨ç°ï¼Œå°¤å…¶æ˜¯ç”±äºæ°´åˆ†ä¸è¶³æˆ–ç¯å¢ƒæ¸©åº¦æ³¢åŠ¨ç­‰å› ç´ å¼•èµ·çš„å¶å°–æ¯èç°è±¡ã€‚è¯¥ç±»åˆ«çš„æ•°æ®æ ·æœ¬å±•ç¤ºäº†ç”Ÿèœå¶ç‰‡çš„ä¸åŒæŸä¼¤ç¨‹åº¦ï¼ŒåŒ…æ‹¬è½»å¾®çš„å¶å°–å¹²æ¯å’Œä¸¥é‡çš„å¶ç‰‡å˜è‰²ç­‰ç‰¹å¾ã€‚è¿™äº›æ ·æœ¬çš„å¤šæ ·æ€§ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°è¯†åˆ«å’Œåˆ†å‰²å‡ºå—æŸçš„ç”ŸèœåŒºåŸŸï¼Œä»è€Œä¸ºåç»­çš„å¥åº·è¯„ä¼°æä¾›ä¾æ®ã€‚

æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹ä¸¥æ ¼éµå¾ªäº†æ•°æ®æ ‡æ³¨çš„æ ‡å‡†åŒ–æµç¨‹ï¼Œç¡®ä¿æ¯ä¸€å¼ å›¾åƒéƒ½ç»è¿‡ä¸“ä¸šäººå‘˜çš„å®¡æ ¸å’Œæ ‡æ³¨ã€‚æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°é‡ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œä»¥ä¿è¯æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿè·å¾—å‡è¡¡çš„å­¦ä¹ æœºä¼šï¼Œé¿å…å› ç±»åˆ«ä¸å¹³è¡¡è€Œå¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†è¿˜åŒ…å«äº†å¤šç§æ‹æ‘„è§’åº¦å’ŒèƒŒæ™¯ï¼Œä»¥æé«˜æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„é€‚åº”æ€§å’Œå‡†ç¡®æ€§ã€‚

ä¸ºäº†è¿›ä¸€æ­¥æå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬è¿˜å¯¹æ•°æ®é›†è¿›è¡Œäº†æ•°æ®å¢å¼ºå¤„ç†ï¼ŒåŒ…æ‹¬éšæœºè£å‰ªã€æ—‹è½¬ã€äº®åº¦è°ƒæ•´ç­‰æ“ä½œã€‚è¿™äº›æŠ€æœ¯æ‰‹æ®µä¸ä»…å¢åŠ äº†æ•°æ®é›†çš„å¤šæ ·æ€§ï¼Œè¿˜å¸®åŠ©æ¨¡å‹æ›´å¥½åœ°é€‚åº”ä¸åŒçš„ç¯å¢ƒå˜åŒ–å’Œæ‹æ‘„æ¡ä»¶ï¼Œä»è€Œæé«˜äº†å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„å¯é æ€§ã€‚

æ€»ä¹‹ï¼Œâ€œcapstone1-2â€æ•°æ®é›†ä¸ºæœ¬ç ”ç©¶æä¾›äº†ä¸°å¯Œçš„æ ·æœ¬å’Œå¤šæ ·çš„ç‰¹å¾ï¼Œä½¿å¾—YOLOv8-segæ¨¡å‹èƒ½å¤Ÿåœ¨ç”Ÿèœå¥åº·çŠ¶æ€åˆ†å‰²ä»»åŠ¡ä¸­å–å¾—ä¼˜å¼‚çš„è¡¨ç°ã€‚é€šè¿‡å¯¹å¥åº·ç”Ÿèœä¸Tipburnç—…ç—‡çš„æœ‰æ•ˆåŒºåˆ†ï¼Œæ¨¡å‹å°†ä¸ºå†œä¸šç”Ÿäº§ä¸­çš„ç—…å®³ç›‘æµ‹å’Œç®¡ç†æä¾›é‡è¦çš„æŠ€æœ¯æ”¯æŒï¼ŒåŠ©åŠ›å®ç°ç²¾å‡†å†œä¸šçš„ç›®æ ‡ã€‚æ•°æ®é›†çš„è®¾è®¡å’Œæ„å»ºè¿‡ç¨‹ä¸ºåç»­çš„ç ”ç©¶å’Œåº”ç”¨å¥ å®šäº†åšå®çš„åŸºç¡€ï¼ŒæœŸå¾…å…¶åœ¨å®é™…åœºæ™¯ä¸­çš„å¹¿æ³›åº”ç”¨ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.bilibili.com/video/BV1jG4Ve4E9t/?vd_source=bc9aec86d164b67a7004b996143742dc)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.bilibili.com/video/BV1nA4VeYEze/?vd_source=bc9aec86d164b67a7004b996143742dc)

### 6.æ‰‹æŠŠæ‰‹YOLOV8-segè®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8-segè®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.bilibili.com/video/BV1cA4VeYETe/?vd_source=bc9aec86d164b67a7004b996143742dc)


æŒ‰ç…§ä¸Šé¢çš„è®­ç»ƒè§†é¢‘æ•™ç¨‹é“¾æ¥åŠ è½½é¡¹ç›®æä¾›çš„æ•°æ®é›†ï¼Œè¿è¡Œtrain.pyå³å¯å¼€å§‹è®­ç»ƒ
ï»¿


     Epoch   gpu_mem       box       obj       cls    labels  img_size
     1/200     0G   0.01576   0.01955  0.007536        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:42<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:14<00:00,  2.87it/s]
                 all       3395      17314      0.994      0.957      0.0957      0.0843

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     2/200     0G   0.01578   0.01923  0.007006        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:44<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:12<00:00,  2.95it/s]
                 all       3395      17314      0.996      0.956      0.0957      0.0845

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     3/200     0G   0.01561    0.0191  0.006895        27      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [10:56<00:00,  1.29it/s]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 187/213 [00:52<00:00,  4.04it/s]
                 all       3395      17314      0.996      0.957      0.0957      0.0845




### 7.50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.bilibili.com/video/BV1Hw4VePEXv/?vd_source=bc9aec86d164b67a7004b996143742dc)

### 8.YOLOV8-segå›¾åƒåˆ†å‰²ç®—æ³•åŸç†

åŸå§‹YOLOv8-segç®—æ³•åŸç†

YOLOv8-segç®—æ³•æ˜¯YOLOç³»åˆ—ç›®æ ‡æ£€æµ‹ç®—æ³•çš„æœ€æ–°è¿›å±•ï¼Œå®ƒåœ¨ç›®æ ‡æ£€æµ‹çš„åŸºç¡€ä¸Šï¼Œæ‰©å±•äº†å›¾åƒåˆ†å‰²çš„èƒ½åŠ›ï¼Œæˆä¸ºä¸€ç§å¼ºå¤§çš„å®æ—¶å›¾åƒå¤„ç†å·¥å…·ã€‚YOLOï¼ˆYou Only Look Onceï¼‰ä½œä¸ºä¸€ç§ä¸€é˜¶æ®µç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œæœ€åˆé€šè¿‡å°†ç›®æ ‡æ£€æµ‹ä»»åŠ¡è½¬åŒ–ä¸ºå›å½’é—®é¢˜ï¼Œåˆ©ç”¨å•ä¸€ç¥ç»ç½‘ç»œæ¨¡å‹åŒæ—¶é¢„æµ‹ç›®æ ‡çš„ä½ç½®å’Œç±»åˆ«ï¼Œè¿…é€Ÿå¼•èµ·äº†å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œçš„å¹¿æ³›å…³æ³¨ã€‚YOLOv8åœ¨å‰å‡ ä»£çš„åŸºç¡€ä¸Šè¿›è¡Œäº†è¯¸å¤šåˆ›æ–°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å‹ç»“æ„ã€è®­ç»ƒç­–ç•¥å’Œæ¨ç†æ•ˆç‡ç­‰æ–¹é¢è¿›è¡Œäº†æ˜¾è‘—çš„æ”¹è¿›ã€‚

YOLOv8çš„ç½‘ç»œç»“æ„ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šä¸»å¹²ç½‘ç»œï¼ˆBackboneï¼‰ã€ç‰¹å¾å¢å¼ºç½‘ç»œï¼ˆNeckï¼‰å’Œæ£€æµ‹å¤´ï¼ˆHeadï¼‰ã€‚åœ¨ä¸»å¹²ç½‘ç»œéƒ¨åˆ†ï¼ŒYOLOv8é‡‡ç”¨äº†CSPï¼ˆCross Stage Partialï¼‰ç½‘ç»œçš„è®¾è®¡ç†å¿µï¼Œåˆ©ç”¨ä¸€ç³»åˆ—å·ç§¯å’Œåå·ç§¯å±‚æå–å›¾åƒç‰¹å¾ã€‚CSPNetçš„è®¾è®¡æ€æƒ³é€šè¿‡åˆ†æµçš„æ–¹å¼ï¼Œå¢å¼ºäº†ç‰¹å¾æå–çš„èƒ½åŠ›ï¼ŒåŒæ—¶å‡å°äº†æ¨¡å‹çš„å¤æ‚åº¦ã€‚YOLOv8å¼•å…¥äº†C2Fæ¨¡å—ï¼Œå–ä»£äº†YOLOv5ä¸­çš„C3æ¨¡å—ï¼Œè¿™ä¸€æ”¹è¿›ä½¿å¾—ç½‘ç»œåœ¨ä¿æŒè½»é‡åŒ–çš„åŒæ—¶ï¼Œèƒ½å¤Ÿè·å–æ›´ä¸°å¯Œçš„æ¢¯åº¦æµä¿¡æ¯ï¼Œä»è€Œæé«˜äº†æ¨¡å‹çš„ç²¾åº¦å’Œæ¨ç†é€Ÿåº¦ã€‚

åœ¨ç‰¹å¾å¢å¼ºç½‘ç»œéƒ¨åˆ†ï¼ŒYOLOv8é‡‡ç”¨äº†PAN-FPNï¼ˆPath Aggregation Network - Feature Pyramid Networkï¼‰çš„ç»“æ„ï¼Œé€šè¿‡å¤šå°ºåº¦ç‰¹å¾èåˆæŠ€æœ¯ï¼Œå°†æ¥è‡ªä¸»å¹²ç½‘ç»œä¸åŒé˜¶æ®µçš„ç‰¹å¾å›¾è¿›è¡Œæœ‰æ•ˆèåˆã€‚è¿™ç§èåˆæ–¹å¼ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰ä¸åŒå°ºåº¦ç›®æ ‡çš„ä¿¡æ¯ï¼Œæå‡äº†ç›®æ ‡æ£€æµ‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚ç‰¹å¾å¢å¼ºç½‘ç»œçš„è®¾è®¡ä¸ä»…æå‡äº†æ¨¡å‹çš„æ•´ä½“è¡¨ç°ï¼Œè¿˜ä½¿å¾—YOLOv8åœ¨å¤„ç†å¤æ‚åœºæ™¯æ—¶è¡¨ç°å¾—æ›´åŠ å‡ºè‰²ã€‚

YOLOv8çš„æ£€æµ‹å¤´éƒ¨åˆ†åˆ™æ˜¯å…¶åˆ›æ–°çš„æ ¸å¿ƒæ‰€åœ¨ã€‚ä¸ä»¥å¾€çš„è€¦åˆå¤´ï¼ˆCoupled-Headï¼‰ä¸åŒï¼ŒYOLOv8é‡‡ç”¨äº†è§£è€¦å¤´ï¼ˆDecoupled-Headï¼‰ç»“æ„ï¼Œå°†ç›®æ ‡æ£€æµ‹å’Œåˆ†ç±»ä»»åŠ¡åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„åˆ†æ”¯ã€‚è¿™ç§è§£è€¦è®¾è®¡ä½¿å¾—æ¨¡å‹åœ¨å¤„ç†å¤æ‚åœºæ™¯æ—¶èƒ½å¤Ÿæ›´ä¸“æ³¨äºå„è‡ªçš„ä»»åŠ¡ï¼Œæ˜¾è‘—é™ä½äº†å®šä½ä¸å‡†å’Œåˆ†ç±»é”™è¯¯çš„æ¦‚ç‡ã€‚æ­¤å¤–ï¼ŒYOLOv8æ‘’å¼ƒäº†ä¼ ç»Ÿçš„Anchor-basedï¼ˆåŸºäºé”šæ¡†ï¼‰æ–¹æ³•ï¼Œè½¬è€Œé‡‡ç”¨Anchor-freeï¼ˆæ— é”šæ¡†ï¼‰ç›®æ ‡æ£€æµ‹ç­–ç•¥ã€‚è¿™ä¸€ç­–ç•¥é€šè¿‡ç›´æ¥é¢„æµ‹ç›®æ ‡çš„ä½ç½®å’Œå¤§å°ï¼Œç®€åŒ–äº†æ¨¡å‹çš„è®¾è®¡ï¼Œå‡å°‘äº†è®¡ç®—å¤æ‚åº¦ï¼ŒåŒæ—¶æå‡äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚

åœ¨YOLOv8-segçš„å®ç°ä¸­ï¼Œå›¾åƒåˆ†å‰²ä»»åŠ¡è¢«æœ‰æ•ˆæ•´åˆè¿›äº†ç›®æ ‡æ£€æµ‹æ¡†æ¶ä¸­ã€‚YOLOv8-segä¸ä»…èƒ½å¤Ÿè¯†åˆ«å›¾åƒä¸­çš„ç›®æ ‡ï¼Œè¿˜èƒ½å¤Ÿç²¾ç¡®åœ°åˆ†å‰²å‡ºç›®æ ‡çš„è½®å»“ã€‚è¿™ä¸€åŠŸèƒ½çš„å®ç°ä¾èµ–äºYOLOv8çš„ç‰¹å¾æå–å’Œèåˆèƒ½åŠ›ï¼Œç»“åˆè§£è€¦å¤´çš„è®¾è®¡ï¼Œä½¿å¾—åˆ†å‰²ä»»åŠ¡å¯ä»¥åœ¨ç›®æ ‡æ£€æµ‹çš„åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ã€‚å…·ä½“è€Œè¨€ï¼ŒYOLOv8-segåœ¨å¤„ç†å›¾åƒæ—¶ï¼Œé€šè¿‡å¯¹ç‰¹å¾å›¾çš„è¿›ä¸€æ­¥å¤„ç†ï¼Œç”Ÿæˆæ¯ä¸ªåƒç´ çš„åˆ†ç±»ä¿¡æ¯ï¼Œä»è€Œå®ç°ç²¾ç»†çš„åˆ†å‰²æ•ˆæœã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒYOLOv8-segå¼•å…¥äº†Mosaicå¢å¼ºæŠ€æœ¯ï¼Œé€šè¿‡å°†å¤šå¼ å›¾åƒæ‹¼æ¥æˆä¸€å¼ æ–°å›¾åƒï¼Œè¿«ä½¿æ¨¡å‹å­¦ä¹ åˆ°ä¸åŒä½ç½®å’Œå‘¨å›´åƒç´ çš„ç‰¹å¾ã€‚è¿™ç§æ•°æ®å¢å¼ºç­–ç•¥ä¸ä»…æé«˜äº†æ¨¡å‹çš„é²æ£’æ€§ï¼Œè¿˜æœ‰æ•ˆæå‡äº†é¢„æµ‹ç²¾åº¦ã€‚æ­¤å¤–ï¼ŒYOLOv8-segåœ¨æŸå¤±å‡½æ•°çš„è®¾è®¡ä¸Šä¹Ÿè¿›è¡Œäº†åˆ›æ–°ï¼Œé‡‡ç”¨äº†DFLï¼ˆDistribution Focal Lossï¼‰å’ŒCIoUï¼ˆComplete Intersection over Unionï¼‰æŸå¤±ï¼Œæ—¨åœ¨ä½¿æ¨¡å‹å¿«é€Ÿèšç„¦äºç›®æ ‡çš„è¾¹ç•Œï¼Œæé«˜äº†è®­ç»ƒçš„æ•ˆç‡å’Œæ•ˆæœã€‚

YOLOv8-segçš„è¾“å…¥å¤„ç†ä¹Ÿç»è¿‡äº†ä¼˜åŒ–ï¼Œæ”¯æŒè‡ªé€‚åº”å›¾ç‰‡ç¼©æ”¾ï¼Œä»¥æé«˜ç›®æ ‡æ£€æµ‹å’Œæ¨ç†çš„é€Ÿåº¦ã€‚æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­èƒ½å¤Ÿæ ¹æ®è¾“å…¥å›¾åƒçš„é•¿å®½æ¯”ï¼Œçµæ´»è°ƒæ•´å›¾åƒå°ºå¯¸ï¼Œå°½é‡å‡å°‘ä¿¡æ¯å†—ä½™ï¼Œä»è€Œæé«˜æ£€æµ‹æ•ˆç‡ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—YOLOv8-segèƒ½å¤Ÿå¹¿æ³›åº”ç”¨äºå„ç§å®æ—¶æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡ä¸­ï¼Œå¦‚è‡ªåŠ¨é©¾é©¶ã€å®‰é˜²ç›‘æ§ã€åŒ»å­¦å½±åƒåˆ†æç­‰é¢†åŸŸã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8-segç®—æ³•åœ¨YOLOç³»åˆ—çš„åŸºç¡€ä¸Šï¼Œç»“åˆäº†æœ€æ–°çš„ç½‘ç»œç»“æ„è®¾è®¡å’Œè®­ç»ƒç­–ç•¥ï¼Œå±•ç°å‡ºäº†å“è¶Šçš„æ€§èƒ½å’Œçµæ´»æ€§ã€‚å…¶åœ¨ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²ä»»åŠ¡ä¸­çš„åº”ç”¨æ½œåŠ›å·¨å¤§ï¼Œèƒ½å¤Ÿæ»¡è¶³å®æ—¶å¤„ç†çš„éœ€æ±‚ï¼Œä¸ºè®¡ç®—æœºè§†è§‰é¢†åŸŸçš„ç ”ç©¶å’Œåº”ç”¨æä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚éšç€YOLOv8-segçš„ä¸æ–­å‘å±•å’Œå®Œå–„ï¼Œæœªæ¥çš„ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²æŠ€æœ¯å°†ä¼šè¿æ¥æ›´å¤šçš„åˆ›æ–°å’Œçªç ´ã€‚

![18.png](18.png)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV11ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

#### 10.1 ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[10.1 50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

#### 10.2 éƒ¨åˆ†æ”¹è¿›æ¨¡å—åŸç†è®²è§£(å®Œæ•´çš„æ”¹è¿›åŸç†è§ä¸Šå›¾å’ŒæŠ€æœ¯åšå®¢é“¾æ¥)ã€å¦‚æœæ­¤å°èŠ‚çš„å›¾åŠ è½½å¤±è´¥å¯ä»¥é€šè¿‡CSDNæˆ–è€…Githubæœç´¢è¯¥åšå®¢çš„æ ‡é¢˜è®¿é—®åŸå§‹åšå®¢ï¼ŒåŸå§‹åšå®¢å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸ã€‘
ï»¿### FasterNetç®€ä»‹
ç¥ç»ç½‘ç»œåœ¨å›¾åƒåˆ†ç±»ã€æ£€æµ‹å’Œåˆ†å‰²ç­‰å„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­ç»å†äº†å¿«é€Ÿå‘å±•ã€‚å°½ç®¡å…¶ä»¤äººå°è±¡æ·±åˆ»çš„æ€§èƒ½ä¸ºè®¸å¤šåº”ç”¨ç¨‹åºæä¾›äº†åŠ¨åŠ›ï¼Œä½†ä¸€ä¸ªå·¨å¤§çš„è¶‹åŠ¿æ˜¯è¿½æ±‚å…·æœ‰ä½å»¶è¿Ÿå’Œé«˜ååé‡çš„å¿«é€Ÿç¥ç»ç½‘ç»œï¼Œä»¥è·å¾—è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€å³æ—¶å“åº”å’Œå®‰å…¨åŸå› ç­‰ã€‚

å¦‚ä½•å¿«é€Ÿï¼Ÿç ”ç©¶äººå‘˜å’Œä»ä¸šè€…ä¸éœ€è¦æ›´æ˜‚è´µçš„è®¡ç®—è®¾å¤‡ï¼Œè€Œæ˜¯å€¾å‘äºè®¾è®¡å…·æœ‰æˆæœ¬æ•ˆç›Šçš„å¿«é€Ÿç¥ç»ç½‘ç»œï¼Œé™ä½è®¡ç®—å¤æ‚åº¦ï¼Œä¸»è¦ä»¥æµ®ç‚¹è¿ç®—ï¼ˆFLOPsï¼‰çš„æ•°é‡æ¥è¡¡é‡ã€‚

MobileNetã€ShuffleNetå’ŒGhostNetç­‰åˆ©ç”¨æ·±åº¦å·ç§¯ï¼ˆDWConvï¼‰å’Œ/æˆ–ç»„å·ç§¯ï¼ˆGConvï¼‰æ¥æå–ç©ºé—´ç‰¹å¾ã€‚ç„¶è€Œï¼Œåœ¨å‡å°‘FLOPsçš„è¿‡ç¨‹ä¸­ï¼Œç®—å­ç»å¸¸ä¼šå—åˆ°å†…å­˜è®¿é—®å¢åŠ çš„å‰¯ä½œç”¨çš„å½±å“ã€‚MicroNetè¿›ä¸€æ­¥åˆ†è§£å’Œç¨€ç–ç½‘ç»œï¼Œå°†å…¶FLOPsæ¨è‡³æä½æ°´å¹³ã€‚å°½ç®¡è¿™ç§æ–¹æ³•åœ¨FLOPsæ–¹é¢æœ‰æ‰€æ”¹è¿›ï¼Œä½†å…¶ç¢ç‰‡è®¡ç®—æ•ˆç‡å¾ˆä½ã€‚æ­¤å¤–ï¼Œä¸Šè¿°ç½‘ç»œé€šå¸¸ä¼´éšç€é¢å¤–çš„æ•°æ®æ“ä½œï¼Œå¦‚çº§è”ã€Shuffleå’Œæ± åŒ–ï¼Œè¿™äº›æ“ä½œçš„è¿è¡Œæ—¶é—´å¯¹äºå°å‹æ¨¡å‹æ¥è¯´å¾€å¾€å¾ˆé‡è¦ã€‚

é™¤äº†ä¸Šè¿°çº¯å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNsï¼‰ä¹‹å¤–ï¼Œäººä»¬å¯¹ä½¿è§†è§‰Transformerï¼ˆViTsï¼‰å’Œå¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰æ¶æ„æ›´å°æ›´å¿«ä¹Ÿè¶Šæ¥è¶Šæ„Ÿå…´è¶£ã€‚ä¾‹å¦‚ï¼ŒMobileViTå’ŒMobileFormeré€šè¿‡å°†DWConvä¸æ”¹è¿›çš„æ³¨æ„åŠ›æœºåˆ¶ç›¸ç»“åˆï¼Œé™ä½äº†è®¡ç®—å¤æ‚æ€§ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä»ç„¶å—åˆ°DWConvçš„ä¸Šè¿°é—®é¢˜çš„å›°æ‰°ï¼Œå¹¶ä¸”è¿˜éœ€è¦ä¿®æ”¹çš„æ³¨æ„åŠ›æœºåˆ¶çš„ä¸“ç”¨ç¡¬ä»¶æ”¯æŒã€‚ä½¿ç”¨å…ˆè¿›ä½†è€—æ—¶çš„æ ‡å‡†åŒ–å’Œæ¿€æ´»å±‚ä¹Ÿå¯èƒ½é™åˆ¶å…¶åœ¨è®¾å¤‡ä¸Šçš„é€Ÿåº¦ã€‚

æ‰€æœ‰è¿™äº›é—®é¢˜ä¸€èµ·å¯¼è‡´äº†ä»¥ä¸‹é—®é¢˜ï¼šè¿™äº›â€œå¿«é€Ÿâ€çš„ç¥ç»ç½‘ç»œçœŸçš„å¾ˆå¿«å—ï¼Ÿä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œä½œè€…æ£€æŸ¥äº†å»¶è¿Ÿå’ŒFLOPsä¹‹é—´çš„å…³ç³»ï¼Œè¿™ç”±
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/af9b21bbd9814ef1818477936d84565f.png)


å…¶ä¸­FLOPSæ˜¯æ¯ç§’æµ®ç‚¹è¿ç®—çš„ç¼©å†™ï¼Œä½œä¸ºæœ‰æ•ˆè®¡ç®—é€Ÿåº¦çš„åº¦é‡ã€‚è™½ç„¶æœ‰è®¸å¤šå‡å°‘FLOPsçš„å°è¯•ï¼Œä½†éƒ½å¾ˆå°‘è€ƒè™‘åŒæ—¶ä¼˜åŒ–FLOPsä»¥å®ç°çœŸæ­£çš„ä½å»¶è¿Ÿã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ç§æƒ…å†µï¼Œä½œè€…æ¯”è¾ƒäº†Intel CPUä¸Šå…¸å‹ç¥ç»ç½‘ç»œçš„FLOPSã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/1edf5326f11f4d82a2e3a90aa2616564.png)


å›¾ä¸­çš„ç»“æœè¡¨æ˜ï¼Œè®¸å¤šç°æœ‰ç¥ç»ç½‘ç»œçš„FLOPSè¾ƒä½ï¼Œå…¶FLOPSé€šå¸¸ä½äºæµè¡Œçš„ResNet50ã€‚ç”±äºFLOPSå¦‚æ­¤ä¹‹ä½ï¼Œè¿™äº›â€œå¿«é€Ÿâ€çš„ç¥ç»ç½‘ç»œå®é™…ä¸Šä¸å¤Ÿå¿«ã€‚å®ƒä»¬çš„FLOPså‡å°‘ä¸èƒ½è½¬åŒ–ä¸ºå»¶è¿Ÿçš„ç¡®åˆ‡å‡å°‘é‡ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ä»»ä½•æ”¹å–„ï¼Œç”šè‡³ä¼šå¯¼è‡´æ›´ç³Ÿçš„å»¶è¿Ÿã€‚ä¾‹å¦‚ï¼ŒCycleMLP-B1å…·æœ‰ResNet50çš„ä¸€åŠFLOPsï¼Œä½†è¿è¡Œé€Ÿåº¦è¾ƒæ…¢ï¼ˆå³CycleMLPB1ä¸ResNet50:111.9msä¸69.4msï¼‰ã€‚

è¯·æ³¨æ„ï¼ŒFLOPsä¸å»¶è¿Ÿä¹‹é—´çš„å·®å¼‚åœ¨ä¹‹å‰çš„å·¥ä½œä¸­ä¹Ÿå·²è¢«æ³¨æ„åˆ°ï¼Œä½†ç”±äºå®ƒä»¬é‡‡ç”¨äº†DWConv/GConvå’Œå…·æœ‰ä½FLOPsçš„å„ç§æ•°æ®å¤„ç†ï¼Œå› æ­¤éƒ¨åˆ†é—®é¢˜ä»æœªè§£å†³ã€‚äººä»¬è®¤ä¸ºæ²¡æœ‰æ›´å¥½çš„é€‰æ‹©ã€‚

è¯¥åšå®¢æä¾›çš„æ–¹æ¡ˆé€šè¿‡å¼€å‘ä¸€ç§ç®€å•ã€å¿«é€Ÿã€æœ‰æ•ˆçš„è¿ç®—ç¬¦æ¥æ¶ˆé™¤è¿™ç§å·®å¼‚ï¼Œè¯¥è¿ç®—ç¬¦å¯ä»¥åœ¨å‡å°‘FLOPsçš„æƒ…å†µä¸‹ä¿æŒé«˜FLOPSã€‚

å…·ä½“æ¥è¯´ï¼Œä½œè€…é‡æ–°å®¡è§†äº†ç°æœ‰çš„æ“ä½œç¬¦ï¼Œç‰¹åˆ«æ˜¯DWConvçš„è®¡ç®—é€Ÿåº¦â€”â€”FLOPSã€‚ä½œè€…å‘ç°å¯¼è‡´ä½FLOPSé—®é¢˜çš„ä¸»è¦åŸå› æ˜¯é¢‘ç¹çš„å†…å­˜è®¿é—®ã€‚ç„¶åï¼Œä½œè€…æå‡ºäº†PConvä½œä¸ºä¸€ç§ç«äº‰æ€§æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒå‡å°‘äº†è®¡ç®—å†—ä½™ä»¥åŠå†…å­˜è®¿é—®çš„æ•°é‡ã€‚

å›¾1è¯´æ˜äº†PConvçš„è®¾è®¡ã€‚å®ƒåˆ©ç”¨äº†ç‰¹å¾å›¾ä¸­çš„å†—ä½™ï¼Œå¹¶ç³»ç»Ÿåœ°ä»…åœ¨ä¸€éƒ¨åˆ†è¾“å…¥é€šé“ä¸Šåº”ç”¨è§„åˆ™å·ç§¯ï¼ˆConvï¼‰ï¼Œè€Œä¸å½±å“å…¶ä½™é€šé“ã€‚æœ¬è´¨ä¸Šï¼ŒPConvçš„FLOPsä½äºå¸¸è§„Convï¼Œè€ŒFLOPsé«˜äºDWConv/GConvã€‚æ¢å¥è¯è¯´ï¼ŒPConvæ›´å¥½åœ°åˆ©ç”¨äº†è®¾å¤‡ä¸Šçš„è®¡ç®—èƒ½åŠ›ã€‚PConvåœ¨æå–ç©ºé—´ç‰¹å¾æ–¹é¢ä¹Ÿå¾ˆæœ‰æ•ˆï¼Œè¿™åœ¨æœ¬æ–‡åé¢çš„å®éªŒä¸­å¾—åˆ°äº†éªŒè¯ã€‚

ä½œè€…è¿›ä¸€æ­¥å¼•å…¥PConvè®¾è®¡äº†FasterNetä½œä¸ºä¸€ä¸ªåœ¨å„ç§è®¾å¤‡ä¸Šè¿è¡Œé€Ÿåº¦éå¸¸å¿«çš„æ–°ç½‘ç»œå®¶æ—ã€‚ç‰¹åˆ«æ˜¯ï¼ŒFasterNetåœ¨åˆ†ç±»ã€æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡æ–¹é¢å®ç°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼ŒåŒæ—¶å…·æœ‰æ›´ä½çš„å»¶è¿Ÿå’Œæ›´é«˜çš„ååé‡ã€‚ä¾‹å¦‚ï¼Œåœ¨GPUã€CPUå’ŒARMå¤„ç†å™¨ä¸Šï¼Œå°æ¨¡å‹FasterNet-T0åˆ†åˆ«æ¯”MobileVitXXSå¿«3.1å€ã€3.1å€å’Œ2.5å€ï¼Œè€Œåœ¨ImageNet-1kä¸Šçš„å‡†ç¡®ç‡é«˜2.9%ã€‚å¤§æ¨¡å‹FasterNet-Lå®ç°äº†83.5%çš„Top-1ç²¾åº¦ï¼Œä¸Swin-Bä¸ç›¸ä¸Šä¸‹ï¼ŒåŒæ—¶åœ¨GPUä¸Šæä¾›äº†49%çš„é«˜ååé‡ï¼Œåœ¨CPUä¸ŠèŠ‚çœäº†42%çš„è®¡ç®—æ—¶é—´ã€‚

æ€»ä¹‹ï¼Œè´¡çŒ®å¦‚ä¸‹ï¼š

æŒ‡å‡ºäº†å®ç°æ›´é«˜FLOPSçš„é‡è¦æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ºäº†æ›´å¿«çš„ç¥ç»ç½‘ç»œè€Œå‡å°‘FLOPsã€‚

å¼•å…¥äº†ä¸€ç§ç®€å•ä½†å¿«é€Ÿä¸”æœ‰æ•ˆçš„å·ç§¯PConvï¼Œå®ƒå¾ˆæœ‰å¯èƒ½å–ä»£ç°æœ‰çš„é€‰æ‹©DWConvã€‚

æ¨å‡ºFasterNetï¼Œå®ƒåœ¨GPUã€CPUå’ŒARMå¤„ç†å™¨ç­‰å¤šç§è®¾å¤‡ä¸Šè¿è¡Œè‰¯å¥½ä¸”æ™®éå¿«é€Ÿã€‚

å¯¹å„ç§ä»»åŠ¡è¿›è¡Œäº†å¹¿æ³›çš„å®éªŒï¼Œå¹¶éªŒè¯äº†PConvå’ŒFasterNetçš„é«˜é€Ÿæ€§å’Œæœ‰æ•ˆæ€§ã€‚

### Convå’ŒFasterNetçš„è®¾è®¡
#### åŸç†

DWConvæ˜¯Convçš„ä¸€ç§æµè¡Œå˜ä½“ï¼Œå·²è¢«å¹¿æ³›ç”¨ä½œè®¸å¤šç¥ç»ç½‘ç»œçš„å…³é”®æ„å»ºå—ã€‚å¯¹äºè¾“å…¥ï¼ŒDWConvåº”ç”¨ä¸ªæ»¤æ³¢å™¨æ¥è®¡ç®—è¾“å‡ºã€‚å¦‚å›¾ï¼ˆbï¼‰æ‰€ç¤ºï¼Œæ¯ä¸ªæ»¤æ³¢å™¨åœ¨ä¸€ä¸ªè¾“å…¥é€šé“ä¸Šè¿›è¡Œç©ºé—´æ»‘åŠ¨ï¼Œå¹¶å¯¹ä¸€ä¸ªè¾“å‡ºé€šé“åšå‡ºè´¡çŒ®ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/eb9025900f804862842703e597db860a.png)
ä¸å…·æœ‰çš„FLOPså¸¸è§„Convç›¸æ¯”ï¼Œè¿™ç§æ·±åº¦è®¡ç®—ä½¿å¾—DWConvä»…ä»…å…·æœ‰çš„FLOPsã€‚è™½ç„¶åœ¨å‡å°‘FLOPsæ–¹é¢æœ‰æ•ˆï¼Œä½†DWConvï¼ˆé€šå¸¸åè·Ÿé€ç‚¹å·ç§¯æˆ–PWConvï¼‰ä¸èƒ½ç®€å•åœ°ç”¨äºæ›¿æ¢å¸¸è§„Convï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´ä¸¥é‡çš„ç²¾åº¦ä¸‹é™ã€‚å› æ­¤ï¼Œåœ¨å®è·µä¸­ï¼ŒDWConvçš„é€šé“æ•°ï¼ˆæˆ–ç½‘ç»œå®½åº¦ï¼‰å¢åŠ åˆ°ï¼ä»¥è¡¥å¿ç²¾åº¦ä¸‹é™ï¼Œä¾‹å¦‚ï¼Œå€’ç½®æ®‹å·®å—ä¸­çš„DWConvå®½åº¦æ‰©å±•äº†6å€ã€‚ç„¶è€Œï¼Œè¿™ä¼šå¯¼è‡´æ›´é«˜çš„å†…å­˜è®¿é—®ï¼Œè¿™ä¼šé€ æˆä¸å¯å¿½ç•¥çš„å»¶è¿Ÿï¼Œå¹¶é™ä½æ€»ä½“è®¡ç®—é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯å¯¹äºI/Oç»‘å®šè®¾å¤‡ã€‚ç‰¹åˆ«æ˜¯ï¼Œå†…å­˜è®¿é—®çš„æ•°é‡ç°åœ¨ä¸Šå‡åˆ°
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/0fb50e3e8c5645128630b75db9279ec5.png)



å®ƒæ¯”ä¸€ä¸ªå¸¸è§„çš„Convçš„å€¼è¦é«˜ï¼Œå³ï¼Œ
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/fb131f5cb0b94273a18f729bc7c32371.png)


æ³¨æ„ï¼Œå†…å­˜è®¿é—®èŠ±è´¹åœ¨I/Oæ“ä½œä¸Šï¼Œè¿™è¢«è®¤ä¸ºå·²ç»æ˜¯æœ€å°çš„æˆæœ¬ï¼Œå¾ˆéš¾è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

#### PConvä½œä¸ºä¸€ä¸ªåŸºæœ¬çš„ç®—å­
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/49b3143768214a518de44126b7c5725c.png)

åœ¨ä¸‹é¢æ¼”ç¤ºäº†é€šè¿‡åˆ©ç”¨ç‰¹å¾å›¾çš„å†—ä½™åº¦å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æˆæœ¬ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œç‰¹å¾å›¾åœ¨ä¸åŒé€šé“ä¹‹é—´å…·æœ‰é«˜åº¦ç›¸ä¼¼æ€§ã€‚è®¸å¤šå…¶ä»–è‘—ä½œä¹Ÿæ¶µç›–äº†è¿™ç§å†—ä½™ï¼Œä½†å¾ˆå°‘æœ‰äººä»¥ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼å……åˆ†åˆ©ç”¨å®ƒã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/3e37c87ea54f4eeeaaac96c067ccdea8.png)

å…·ä½“è€Œè¨€ï¼Œä½œè€…æå‡ºäº†ä¸€ç§ç®€å•çš„PConvï¼Œä»¥åŒæ—¶å‡å°‘è®¡ç®—å†—ä½™å’Œå†…å­˜è®¿é—®ã€‚å›¾4ä¸­çš„å·¦ä¸‹è§’è¯´æ˜äº†PConvçš„å·¥ä½œåŸç†ã€‚å®ƒåªéœ€åœ¨è¾“å…¥é€šé“çš„ä¸€éƒ¨åˆ†ä¸Šåº”ç”¨å¸¸è§„Convè¿›è¡Œç©ºé—´ç‰¹å¾æå–ï¼Œå¹¶ä¿æŒå…¶ä½™é€šé“ä¸å˜ã€‚å¯¹äºè¿ç»­æˆ–è§„åˆ™çš„å†…å­˜è®¿é—®ï¼Œå°†ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªè¿ç»­çš„é€šé“è§†ä¸ºæ•´ä¸ªç‰¹å¾å›¾çš„ä»£è¡¨è¿›è¡Œè®¡ç®—ã€‚åœ¨ä¸ä¸§å¤±ä¸€èˆ¬æ€§çš„æƒ…å†µä¸‹è®¤ä¸ºè¾“å…¥å’Œè¾“å‡ºç‰¹å¾å›¾å…·æœ‰ç›¸åŒæ•°é‡çš„é€šé“ã€‚å› æ­¤ï¼ŒPConvçš„FLOPsä»…
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/7f6f66a2006f40c5bd0e28597cda8730.png)


å¯¹äºå…¸å‹çš„rï¼1/4 ï¼ŒPConvçš„FLOPsåªæœ‰å¸¸è§„Convçš„1/16ã€‚æ­¤å¤–ï¼ŒPConvçš„å†…å­˜è®¿é—®é‡è¾ƒå°ï¼Œå³ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/ea1b7eeb1cb748b5b19b4aa2400d9a0d.png)


å¯¹äºrï¼1/4ï¼Œå…¶ä»…ä¸ºå¸¸è§„Convçš„1/4ã€‚

ç”±äºåªæœ‰é€šé“ç”¨äºç©ºé—´ç‰¹å¾æå–ï¼Œäººä»¬å¯èƒ½ä¼šé—®æ˜¯å¦å¯ä»¥ç®€å•åœ°ç§»é™¤å‰©ä½™çš„ï¼ˆcâˆ’ï¼‰é€šé“ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼ŒPConvå°†é€€åŒ–ä¸ºå…·æœ‰è¾ƒå°‘é€šé“çš„å¸¸è§„Convï¼Œè¿™åç¦»äº†å‡å°‘å†—ä½™çš„ç›®æ ‡ã€‚

è¯·æ³¨æ„ï¼Œä¿æŒå…¶ä½™é€šé“ä¸å˜ï¼Œè€Œä¸æ˜¯ä»ç‰¹å¾å›¾ä¸­åˆ é™¤å®ƒä»¬ã€‚è¿™æ˜¯å› ä¸ºå®ƒä»¬å¯¹åç»­PWConvå±‚æœ‰ç”¨ï¼ŒPWConvå…è®¸ç‰¹å¾ä¿¡æ¯æµç»æ‰€æœ‰é€šé“ã€‚

#### PConvä¹‹åæ˜¯PWConv
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/6493c8f68f7f4c5c83363a361c93ac64.png)

ä¸ºäº†å……åˆ†æœ‰æ•ˆåœ°åˆ©ç”¨æ¥è‡ªæ‰€æœ‰é€šé“çš„ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥å°†é€ç‚¹å·ç§¯ï¼ˆPWConvï¼‰é™„åŠ åˆ°PConvã€‚å®ƒä»¬åœ¨è¾“å…¥ç‰¹å¾å›¾ä¸Šçš„æœ‰æ•ˆæ„Ÿå—é‡çœ‹èµ·æ¥åƒä¸€ä¸ªTå½¢Convï¼Œä¸å‡åŒ€å¤„ç†è¡¥ä¸çš„å¸¸è§„Convç›¸æ¯”ï¼Œå®ƒæ›´ä¸“æ³¨äºä¸­å¿ƒä½ç½®ï¼Œå¦‚å›¾5æ‰€ç¤ºã€‚ä¸ºäº†è¯æ˜è¿™ä¸ªTå½¢æ„Ÿå—é‡çš„åˆç†æ€§ï¼Œé¦–å…ˆé€šè¿‡è®¡ç®—ä½ç½®çš„FrobeniusèŒƒæ•°æ¥è¯„ä¼°æ¯ä¸ªä½ç½®çš„é‡è¦æ€§ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/e10d4ab0ef264f3ca1b8d9840ab18ed4.png)

å‡è®¾ï¼Œå¦‚æœä¸€ä¸ªèŒä½æ¯”å…¶ä»–èŒä½å…·æœ‰æ›´å¤§çš„FrobeniusèŒƒæ•°ï¼Œåˆ™è¯¥èŒä½å¾€å¾€æ›´é‡è¦ã€‚å¯¹äºæ­£åˆ™Convæ»¤æ³¢å™¨ï¼Œä½ç½®å¤„çš„FrobeniusèŒƒæ•°ç”±è®¡ç®—ï¼Œå…¶ä¸­ã€‚


ä¸€ä¸ªæ˜¾è‘—ä½ç½®æ˜¯å…·æœ‰æœ€å¤§FrobeniusèŒƒæ•°çš„ä½ç½®ã€‚ç„¶åï¼Œåœ¨é¢„è®­ç»ƒçš„ResNet18ä¸­é›†ä½“æ£€æŸ¥æ¯ä¸ªè¿‡æ»¤å™¨ï¼Œæ‰¾å‡ºå®ƒä»¬çš„æ˜¾è‘—ä½ç½®ï¼Œå¹¶ç»˜åˆ¶æ˜¾è‘—ä½ç½®çš„ç›´æ–¹å›¾ã€‚å›¾6ä¸­çš„ç»“æœè¡¨æ˜ï¼Œä¸­å¿ƒä½ç½®æ˜¯è¿‡æ»¤å™¨ä¸­æœ€å¸¸è§çš„çªå‡ºä½ç½®ã€‚æ¢å¥è¯è¯´ï¼Œä¸­å¿ƒä½ç½®çš„æƒé‡æ¯”å‘¨å›´çš„æ›´é‡ã€‚è¿™ä¸é›†ä¸­äºä¸­å¿ƒä½ç½®çš„Tå½¢è®¡ç®—ä¸€è‡´ã€‚

è™½ç„¶Tå½¢å·ç§¯å¯ä»¥ç›´æ¥ç”¨äºé«˜æ•ˆè®¡ç®—ï¼Œä½†ä½œè€…è¡¨æ˜ï¼Œå°†Tå½¢å·ç§¯åˆ†è§£ä¸ºPConvå’ŒPWConvæ›´å¥½ï¼Œå› ä¸ºè¯¥åˆ†è§£åˆ©ç”¨äº†æ»¤æ³¢å™¨é—´å†—ä½™å¹¶è¿›ä¸€æ­¥èŠ‚çœäº†FLOPsã€‚å¯¹äºç›¸åŒçš„è¾“å…¥å’Œè¾“å‡ºï¼ŒTå½¢Convçš„FLOPså¯ä»¥è®¡ç®—ä¸º:
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/ae95a4eb85ee44569ad6129d2f8db89d.png)


å®ƒé«˜äºPConvå’ŒPWConvçš„æµé‡ï¼Œå³ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/24b0c5981b4648b4bffb9e87725130ab.png)

å…¶ä¸­å’Œï¼ˆä¾‹å¦‚ï¼Œå½“æ—¶ï¼‰ã€‚æ­¤å¤–ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ©ç”¨å¸¸è§„Convè¿›è¡Œä¸¤æ­¥å®ç°ã€‚

# FasterNetä½œä¸ºBackbone
é‰´äºæ–°å‹PConvå’Œç°æˆçš„PWConvä½œä¸ºä¸»è¦çš„ç®—å­ï¼Œè¿›ä¸€æ­¥æå‡ºFasterNetï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°çš„ç¥ç»ç½‘ç»œå®¶æ—ï¼Œè¿è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œå¯¹è®¸å¤šè§†è§‰ä»»åŠ¡éå¸¸æœ‰æ•ˆã€‚ç›®æ ‡æ˜¯ä½¿ä½“ç³»ç»“æ„å°½å¯èƒ½ç®€å•ï¼Œä½¿å…¶æ€»ä½“ä¸Šå¯¹ç¡¬ä»¶å‹å¥½ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/c7196f8ff6774d21a969510e920422e1.png)

åœ¨å›¾ä¸­å±•ç¤ºäº†æ•´ä½“æ¶æ„ã€‚å®ƒæœ‰4ä¸ªå±‚æ¬¡çº§ï¼Œæ¯ä¸ªå±‚æ¬¡çº§å‰é¢éƒ½æœ‰ä¸€ä¸ªåµŒå…¥å±‚ï¼ˆæ­¥é•¿ä¸º4çš„å¸¸è§„4Ã—4å·ç§¯ï¼‰æˆ–ä¸€ä¸ªåˆå¹¶å±‚ï¼ˆæ­¥é•¿ä¸º2çš„å¸¸è§„2Ã—2å·ç§¯ï¼‰ï¼Œç”¨äºç©ºé—´ä¸‹é‡‡æ ·å’Œé€šé“æ•°é‡æ‰©å±•ã€‚æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸€å †FasterNetå—ã€‚ä½œè€…è§‚å¯Ÿåˆ°ï¼Œæœ€åä¸¤ä¸ªé˜¶æ®µä¸­çš„å—æ¶ˆè€—æ›´å°‘çš„å†…å­˜è®¿é—®ï¼Œå¹¶ä¸”å€¾å‘äºå…·æœ‰æ›´é«˜çš„FLOPSï¼Œå¦‚è¡¨1ä¸­çš„ç»éªŒéªŒè¯ã€‚å› æ­¤ï¼Œæ”¾ç½®äº†æ›´å¤šFasterNetå—ï¼Œå¹¶ç›¸åº”åœ°å°†æ›´å¤šè®¡ç®—åˆ†é…ç»™æœ€åä¸¤ä¸ªé˜¶æ®µã€‚æ¯ä¸ªFasterNetå—æœ‰ä¸€ä¸ªPConvå±‚ï¼Œåè·Ÿ2ä¸ªPWConvï¼ˆæˆ–Conv 1Ã—1ï¼‰å±‚ã€‚å®ƒä»¬ä¸€èµ·æ˜¾ç¤ºä¸ºå€’ç½®æ®‹å·®å—ï¼Œå…¶ä¸­ä¸­é—´å±‚å…·æœ‰æ‰©å±•çš„é€šé“æ•°é‡ï¼Œå¹¶ä¸”æ”¾ç½®äº†Shorcutä»¥é‡ç”¨è¾“å…¥ç‰¹å¾ã€‚

é™¤äº†ä¸Šè¿°ç®—å­ï¼Œæ ‡å‡†åŒ–å’Œæ¿€æ´»å±‚å¯¹äºé«˜æ€§èƒ½ç¥ç»ç½‘ç»œä¹Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ç„¶è€Œï¼Œè®¸å¤šå…ˆå‰çš„å·¥ä½œåœ¨æ•´ä¸ªç½‘ç»œä¸­è¿‡åº¦ä½¿ç”¨è¿™äº›å±‚ï¼Œè¿™å¯èƒ½ä¼šé™åˆ¶ç‰¹å¾å¤šæ ·æ€§ï¼Œä»è€ŒæŸå®³æ€§èƒ½ã€‚å®ƒè¿˜å¯ä»¥é™ä½æ•´ä½“è®¡ç®—é€Ÿåº¦ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåªå°†å®ƒä»¬æ”¾åœ¨æ¯ä¸ªä¸­é—´PWConvä¹‹åï¼Œä»¥ä¿æŒç‰¹å¾å¤šæ ·æ€§å¹¶å®ç°è¾ƒä½çš„å»¶è¿Ÿã€‚

æ­¤å¤–ï¼Œä½¿ç”¨æ‰¹æ¬¡å½’ä¸€åŒ–ï¼ˆBNï¼‰ä»£æ›¿å…¶ä»–æ›¿ä»£æ–¹æ³•ã€‚BNçš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥åˆå¹¶åˆ°å…¶ç›¸é‚»çš„Convå±‚ä¸­ï¼Œä»¥ä¾¿æ›´å¿«åœ°è¿›è¡Œæ¨æ–­ï¼ŒåŒæ—¶ä¸å…¶ä»–å±‚ä¸€æ ·æœ‰æ•ˆã€‚å¯¹äºæ¿€æ´»å±‚ï¼Œæ ¹æ®ç»éªŒé€‰æ‹©äº†GELUç”¨äºè¾ƒå°çš„FasterNetå˜ä½“ï¼Œè€ŒReLUç”¨äºè¾ƒå¤§çš„FasterNetå˜ä½“ï¼ŒåŒæ—¶è€ƒè™‘äº†è¿è¡Œæ—¶é—´å’Œæœ‰æ•ˆæ€§ã€‚æœ€åä¸‰ä¸ªå±‚ï¼Œå³å…¨å±€å¹³å‡æ± åŒ–ã€å·ç§¯1Ã—1å’Œå…¨è¿æ¥å±‚ï¼Œä¸€èµ·ç”¨äºç‰¹å¾è½¬æ¢å’Œåˆ†ç±»ã€‚

ä¸ºäº†åœ¨ä¸åŒçš„è®¡ç®—é¢„ç®—ä¸‹æä¾›å¹¿æ³›çš„åº”ç”¨ï¼Œæä¾›FasterNetçš„Tinyæ¨¡å‹ã€Smallæ¨¡å‹ã€Mediumæ¨¡å‹å’ŒBigæ¨¡å‹å˜ä½“ï¼Œåˆ†åˆ«ç§°ä¸ºFasterNetT0/1/2ã€FasterNet-Sã€FasterNet-Må’ŒFasterNet-Lã€‚å®ƒä»¬å…·æœ‰ç›¸ä¼¼çš„ç»“æ„ï¼Œä½†æ·±åº¦å’Œå®½åº¦ä¸åŒã€‚

æ¶æ„è§„èŒƒå¦‚ä¸‹ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/3406ca339a7d43cdbdd3ccdf6c8e3536.png)


### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 ultralytics\nn\extra_modules\kernel_warehouse.py

ä»¥ä¸‹æ˜¯å¯¹ç»™å®šä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œæç‚¼å’Œè¯¦ç»†æ³¨é‡Šçš„ç»“æœï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F
import collections.abc
from itertools import repeat

# å®šä¹‰ä¸€ä¸ªè§£æå‡½æ•°ï¼Œç”¨äºå¤„ç†è¾“å…¥å‚æ•°çš„æ ¼å¼
def parse(x, n):
    if isinstance(x, collections.abc.Iterable):
        if len(x) == 1:
            return list(repeat(x[0], n))  # å¦‚æœè¾“å…¥æ˜¯ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼Œé‡å¤næ¬¡
        elif len(x) == n:
            return x  # å¦‚æœè¾“å…¥é•¿åº¦ä¸nç›¸åŒï¼Œç›´æ¥è¿”å›
        else:
            raise ValueError('length of x should be 1 or n')  # å¦åˆ™æŠ›å‡ºå¼‚å¸¸
    else:
        return list(repeat(x, n))  # å…¶ä»–æƒ…å†µï¼Œé‡å¤x næ¬¡

# å®šä¹‰æ³¨æ„åŠ›æœºåˆ¶ç±»
class Attention(nn.Module):
    def __init__(self, in_planes, reduction, num_static_cell, num_local_mixture, norm_layer=nn.BatchNorm1d,
                 cell_num_ratio=1.0, nonlocal_basis_ratio=1.0, start_cell_idx=None):
        super(Attention, self).__init__()
        hidden_planes = max(int(in_planes * reduction), 16)  # è®¡ç®—éšè—å±‚çš„é€šé“æ•°
        self.kw_planes_per_mixture = num_static_cell + 1  # æ¯ä¸ªæ··åˆç‰©çš„é€šé“æ•°
        self.num_local_mixture = num_local_mixture  # æœ¬åœ°æ··åˆç‰©çš„æ•°é‡
        self.kw_planes = self.kw_planes_per_mixture * num_local_mixture  # æ€»é€šé“æ•°

        # è®¡ç®—æœ¬åœ°å’Œéæœ¬åœ°å•å…ƒçš„æ•°é‡
        self.num_local_cell = int(cell_num_ratio * num_local_mixture)
        self.num_nonlocal_cell = num_static_cell - self.num_local_cell
        self.start_cell_idx = start_cell_idx

        # å®šä¹‰ç½‘ç»œå±‚
        self.avgpool = nn.AdaptiveAvgPool1d(1)  # è‡ªé€‚åº”å¹³å‡æ± åŒ–
        self.fc1 = nn.Linear(in_planes, hidden_planes, bias=(norm_layer is not nn.BatchNorm1d))  # å…¨è¿æ¥å±‚
        self.norm1 = norm_layer(hidden_planes)  # å½’ä¸€åŒ–å±‚
        self.act1 = nn.ReLU(inplace=True)  # æ¿€æ´»å‡½æ•°

        # æ ¹æ®éæœ¬åœ°åŸºæ•°æ¯”ç‡é€‰æ‹©ä¸åŒçš„æ˜ å°„æ–¹å¼
        if nonlocal_basis_ratio >= 1.0:
            self.map_to_cell = nn.Identity()  # ç›´æ¥æ˜ å°„
            self.fc2 = nn.Linear(hidden_planes, self.kw_planes, bias=True)  # ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚
        else:
            self.map_to_cell = self.map_to_cell_basis  # ä½¿ç”¨åŸºäºæ˜ å°„
            self.num_basis = max(int(self.num_nonlocal_cell * nonlocal_basis_ratio), 16)  # åŸºç¡€æ•°é‡
            self.fc2 = nn.Linear(hidden_planes, (self.num_local_cell + self.num_basis + 1) * num_local_mixture, bias=False)
            self.fc3 = nn.Linear(self.num_basis, self.num_nonlocal_cell, bias=False)  # ç”¨äºéæœ¬åœ°å•å…ƒçš„å…¨è¿æ¥å±‚
            self.basis_bias = nn.Parameter(torch.zeros([self.kw_planes]), requires_grad=True).float()  # åŸºç¡€åç½®

        self.temp_bias = torch.zeros([self.kw_planes], requires_grad=False).float()  # æ¸©åº¦åç½®
        self.temp_value = 0  # æ¸©åº¦å€¼
        self._initialize_weights()  # åˆå§‹åŒ–æƒé‡

    def _initialize_weights(self):
        # æƒé‡åˆå§‹åŒ–
        for m in self.modules():
            if isinstance(m, nn.Linear):
                nn.init.kaiming_normal_(m.weight, mode='fan_out', nonlinearity='relu')  # Kaimingåˆå§‹åŒ–
                if m.bias is not None:
                    nn.init.constant_(m.bias, 0)  # åç½®åˆå§‹åŒ–ä¸º0
            if isinstance(m, nn.BatchNorm1d):
                nn.init.constant_(m.weight, 1)  # æ‰¹å½’ä¸€åŒ–æƒé‡åˆå§‹åŒ–ä¸º1
                nn.init.constant_(m.bias, 0)  # åç½®åˆå§‹åŒ–ä¸º0

    def forward(self, x):
        # å‰å‘ä¼ æ’­
        x = self.avgpool(x.reshape(*x.shape[:2], -1)).squeeze(dim=-1)  # æ± åŒ–
        x = self.act1(self.norm1(self.fc1(x)))  # çº¿æ€§å˜æ¢ + å½’ä¸€åŒ– + æ¿€æ´»
        x = self.map_to_cell(self.fc2(x)).reshape(-1, self.kw_planes)  # æ˜ å°„åˆ°å•å…ƒ
        x = x / (torch.sum(torch.abs(x), dim=1).view(-1, 1) + 1e-3)  # å½’ä¸€åŒ–
        x = (1.0 - self.temp_value) * x.reshape(-1, self.kw_planes) + self.temp_value * self.temp_bias.to(x.device).view(1, -1)  # æ¸©åº¦è°ƒæ•´
        return x.reshape(-1, self.kw_planes_per_mixture)[:, :-1]  # è¿”å›ç»“æœ

# å®šä¹‰å·ç§¯å±‚ç±»
class KWconvNd(nn.Module):
    def __init__(self, in_planes, out_planes, kernel_size, stride=1, padding=0, dilation=1, groups=1,
                 bias=False, warehouse_id=None, warehouse_manager=None):
        super(KWconvNd, self).__init__()
        self.in_planes = in_planes  # è¾“å…¥é€šé“æ•°
        self.out_planes = out_planes  # è¾“å‡ºé€šé“æ•°
        self.kernel_size = parse(kernel_size, self.dimension)  # è§£æå·ç§¯æ ¸å¤§å°
        self.stride = parse(stride, self.dimension)  # è§£ææ­¥å¹…
        self.padding = parse(padding, self.dimension)  # è§£æå¡«å……
        self.dilation = parse(dilation, self.dimension)  # è§£æè†¨èƒ€
        self.groups = groups  # åˆ†ç»„å·ç§¯
        self.bias = nn.Parameter(torch.zeros([self.out_planes]), requires_grad=True).float() if bias else None  # åç½®
        self.warehouse_id = warehouse_id  # ä»“åº“ID
        self.warehouse_manager = [warehouse_manager]  # ä»“åº“ç®¡ç†å™¨

    def forward(self, x):
        # å‰å‘ä¼ æ’­
        kw_attention = self.attention(x).type(x.dtype)  # è·å–æ³¨æ„åŠ›æƒé‡
        batch_size = x.shape[0]  # æ‰¹å¤§å°
        x = x.reshape(1, -1, *x.shape[2:])  # é‡å¡‘è¾“å…¥
        weight = self.warehouse_manager[0].take_cell(self.warehouse_id).reshape(self.cell_shape[0], -1).type(x.dtype)  # è·å–æƒé‡
        aggregate_weight = torch.mm(kw_attention, weight)  # æƒé‡èšåˆ
        output = self.func_conv(x, weight=aggregate_weight, bias=None, stride=self.stride, padding=self.padding,
                                dilation=self.dilation, groups=self.groups * batch_size)  # å·ç§¯æ“ä½œ
        output = output.view(batch_size, self.out_planes, *output.shape[2:])  # é‡å¡‘è¾“å‡º
        if self.bias is not None:
            output = output + self.bias.reshape(1, -1, *([1]*self.dimension))  # æ·»åŠ åç½®
        return output  # è¿”å›è¾“å‡º

# å®šä¹‰ä»“åº“ç®¡ç†å™¨ç±»
class Warehouse_Manager(nn.Module):
    def __init__(self, reduction=0.0625, cell_num_ratio=1, cell_inplane_ratio=1,
                 cell_outplane_ratio=1, sharing_range=(), nonlocal_basis_ratio=1,
                 norm_layer=nn.BatchNorm1d, spatial_partition=True):
        super(Warehouse_Manager, self).__init__()
        self.sharing_range = sharing_range  # å…±äº«èŒƒå›´
        self.warehouse_list = {}  # ä»“åº“åˆ—è¡¨
        self.reduction = reduction  # å‡å°‘æ¯”ç‡
        self.spatial_partition = spatial_partition  # ç©ºé—´åˆ†åŒº
        self.cell_num_ratio = cell_num_ratio  # å•å…ƒæ•°é‡æ¯”ç‡
        self.cell_outplane_ratio = cell_outplane_ratio  # è¾“å‡ºé€šé“æ¯”ç‡
        self.cell_inplane_ratio = cell_inplane_ratio  # è¾“å…¥é€šé“æ¯”ç‡
        self.norm_layer = norm_layer  # å½’ä¸€åŒ–å±‚
        self.nonlocal_basis_ratio = nonlocal_basis_ratio  # éæœ¬åœ°åŸºæ•°æ¯”ç‡
        self.weights = nn.ParameterList()  # æƒé‡åˆ—è¡¨

    def reserve(self, in_planes, out_planes, kernel_size=1, stride=1, padding=0, dilation=1, groups=1,
                bias=True, warehouse_name='default', enabled=True, layer_type='conv2d'):
        # åˆ›å»ºåŠ¨æ€å·ç§¯å±‚å¹¶è®°å½•å…¶ä¿¡æ¯
        kw_mapping = {'conv1d': KWConv1d, 'conv2d': KWConv2d, 'conv3d': KWConv3d, 'linear': KWLinear}
        if not enabled:
            return nn.Conv2d(in_planes, out_planes, kernel_size, stride=stride, padding=padding, dilation=dilation,
                             groups=groups, bias=bias)  # è¿”å›æ ‡å‡†å·ç§¯å±‚
        else:
            layer_type = kw_mapping[layer_type]  # è·å–å¯¹åº”çš„KWå·ç§¯å±‚
            weight_shape = [out_planes, in_planes // groups, *parse(kernel_size, layer_type.dimension)]  # æƒé‡å½¢çŠ¶
            if warehouse_name not in self.warehouse_list.keys():
                self.warehouse_list[warehouse_name] = []  # åˆå§‹åŒ–ä»“åº“
            self.warehouse_list[warehouse_name].append(weight_shape)  # è®°å½•æƒé‡å½¢çŠ¶
            return layer_type(in_planes, out_planes, kernel_size, stride=stride, padding=padding,
                              dilation=dilation, groups=groups, bias=bias,
                              warehouse_id=int(list(self.warehouse_list.keys()).index(warehouse_name)),
                              warehouse_manager=self)  # è¿”å›è‡ªå®šä¹‰å·ç§¯å±‚

    def store(self):
        # å­˜å‚¨ä»“åº“ä¿¡æ¯
        warehouse_names = list(self.warehouse_list.keys())
        for idx, warehouse_name in enumerate(self.warehouse_list.keys()):
            warehouse = self.warehouse_list[warehouse_name]
            dimension = len(warehouse[0]) - 2  # ç»´åº¦
            out_plane_gcd, in_plane_gcd, kernel_size = warehouse[0][0], warehouse[0][1], warehouse[0][2:]  # æœ€å¤§å…¬çº¦æ•°
            for layer in warehouse:
                out_plane_gcd = math.gcd(out_plane_gcd, layer[0])  # è®¡ç®—è¾“å‡ºé€šé“æœ€å¤§å…¬çº¦æ•°
                in_plane_gcd = math.gcd(in_plane_gcd, layer[1])  # è®¡ç®—è¾“å…¥é€šé“æœ€å¤§å…¬çº¦æ•°

            cell_in_plane = max(int(in_plane_gcd * self.cell_inplane_ratio[idx]), 1)  # è®¡ç®—å•å…ƒè¾“å…¥é€šé“æ•°
            cell_out_plane = max(int(out_plane_gcd * self.cell_outplane_ratio[idx]), 1)  # è®¡ç®—å•å…ƒè¾“å‡ºé€šé“æ•°
            cell_kernel_size = parse(1, dimension) if self.spatial_partition[idx] else kernel_size  # è®¡ç®—å•å…ƒå·ç§¯æ ¸å¤§å°

            # è®¡ç®—æ¯ä¸ªé˜¶æ®µçš„æ€»æ··åˆç‰©æ•°é‡
            num_total_mixtures = 0
            for layer in warehouse:
                groups_channel = int(layer[0] // cell_out_plane * layer[1] // cell_in_plane)  # è®¡ç®—é€šé“ç»„æ•°
                groups_spatial = 1
                for d in range(dimension):
                    groups_spatial = int(groups_spatial * layer[2 + d] // cell_kernel_size[d])  # è®¡ç®—ç©ºé—´ç»„æ•°

                num_layer_mixtures = groups_spatial * groups_channel  # è®¡ç®—æ¯å±‚æ··åˆç‰©æ•°é‡
                num_total_mixtures += num_layer_mixtures  # ç´¯åŠ æ€»æ··åˆç‰©æ•°é‡

            self.weights.append(nn.Parameter(torch.randn(
                max(int(num_total_mixtures * self.cell_num_ratio[idx]), 1),
                cell_out_plane, cell_in_plane, *cell_kernel_size), requires_grad=True))  # åˆå§‹åŒ–æƒé‡

    def allocate(self, network):
        # åˆ†é…æƒé‡
        num_warehouse = len(self.weights)
        end_idxs = [0] * num_warehouse  # ç»“æŸç´¢å¼•åˆå§‹åŒ–

        for layer in network.modules():
            if isinstance(layer, KWconvNd):
                warehouse_idx = layer.warehouse_id  # è·å–ä»“åº“ç´¢å¼•
                start_cell_idx = end_idxs[warehouse_idx]  # è·å–å¼€å§‹å•å…ƒç´¢å¼•
                end_cell_idx = layer.init_attention(self.weights[warehouse_idx],
                                                    start_cell_idx,
                                                    self.reduction[warehouse_idx],
                                                    self.cell_num_ratio[warehouse_idx],
                                                    norm_layer=self.norm_layer,
                                                    nonlocal_basis_ratio=self.nonlocal_basis_ratio)  # åˆå§‹åŒ–æ³¨æ„åŠ›
                end_idxs[warehouse_idx] = end_cell_idx  # æ›´æ–°ç»“æŸç´¢å¼•

    def take_cell(self, warehouse_idx):
        return self.weights[warehouse_idx]  # è¿”å›æŒ‡å®šä»“åº“çš„æƒé‡

# æ¸©åº¦è°ƒèŠ‚å‡½æ•°
def get_temperature(iteration, epoch, iter_per_epoch, temp_epoch=20, temp_init_value=30.0, temp_end=0.0):
    total_iter = iter_per_epoch * temp_epoch  # æ€»è¿­ä»£æ¬¡æ•°
    current_iter = iter_per_epoch * epoch + iteration  # å½“å‰è¿­ä»£æ¬¡æ•°
    temperature = temp_end + max(0, (temp_init_value - temp_end) * ((total_iter - current_iter) / max(1.0, total_iter)))  # è®¡ç®—æ¸©åº¦
    return temperature  # è¿”å›æ¸©åº¦
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **`parse` å‡½æ•°**ï¼šç”¨äºå¤„ç†è¾“å…¥å‚æ•°ï¼Œç¡®ä¿è¾“å…¥æ ¼å¼æ­£ç¡®ã€‚
2. **`Attention` ç±»**ï¼šå®ç°äº†ä¸€ä¸ªæ³¨æ„åŠ›æœºåˆ¶ï¼ŒåŒ…æ‹¬æƒé‡åˆå§‹åŒ–ã€å‰å‘ä¼ æ’­ç­‰åŠŸèƒ½ã€‚
3. **`KWconvNd` ç±»**ï¼šè‡ªå®šä¹‰å·ç§¯å±‚ï¼ŒåŒ…å«å‰å‘ä¼ æ’­é€»è¾‘ï¼Œæ”¯æŒåŠ¨æ€æƒé‡è·å–ã€‚
4. **`Warehouse_Manager` ç±»**ï¼šç®¡ç†å·ç§¯å±‚çš„æƒé‡ä»“åº“ï¼Œæ”¯æŒåŠ¨æ€åˆ›å»ºå’Œå­˜å‚¨å·ç§¯å±‚ä¿¡æ¯ã€‚
5. **`get_temperature` å‡½æ•°**ï¼šç”¨äºè®¡ç®—æ¸©åº¦è°ƒèŠ‚ï¼Œæ”¯æŒè®­ç»ƒè¿‡ç¨‹ä¸­çš„åŠ¨æ€è°ƒæ•´ã€‚

è¿™äº›æ ¸å¿ƒéƒ¨åˆ†æ„æˆäº†ä¸€ä¸ªåŠ¨æ€å·ç§¯ç½‘ç»œçš„åŸºç¡€ï¼Œæ”¯æŒé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å’Œä»“åº“ç®¡ç†æ¥ä¼˜åŒ–å·ç§¯æ“ä½œã€‚

è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨äºæ·±åº¦å­¦ä¹ çš„PyTorchæ¨¡å—ï¼Œä¸»è¦å®ç°äº†ä¸€ä¸ªåä¸ºâ€œKernel Warehouseâ€çš„æœºåˆ¶ï¼Œæ—¨åœ¨ä¼˜åŒ–å·ç§¯æ“ä½œä¸­çš„å‚æ•°ç®¡ç†å’Œè®¡ç®—æ•ˆç‡ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œä¸‹é¢å°†é€ä¸€è¿›è¡Œè¯´æ˜ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†å¿…è¦çš„PyTorchåº“å’Œå…¶ä»–å·¥å…·ï¼ŒåŒ…æ‹¬`torch`ã€`torch.nn`ã€`torch.nn.functional`ç­‰ï¼Œè¿™äº›éƒ½æ˜¯æ„å»ºç¥ç»ç½‘ç»œçš„åŸºç¡€æ¨¡å—ã€‚`parse`å‡½æ•°ç”¨äºå¤„ç†è¾“å…¥å‚æ•°ï¼Œç¡®ä¿å…¶æ ¼å¼ç¬¦åˆè¦æ±‚ï¼Œæ”¯æŒå°†å•ä¸€å€¼æ‰©å±•ä¸ºæŒ‡å®šé•¿åº¦çš„åˆ—è¡¨ã€‚

æ¥ä¸‹æ¥æ˜¯`Attention`ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç¥ç»ç½‘ç»œæ¨¡å—ï¼Œä¸»è¦ç”¨äºå®ç°æ³¨æ„åŠ›æœºåˆ¶ã€‚è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°æ¥æ”¶å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬è¾“å…¥é€šé“æ•°ã€ç¼©å‡æ¯”ä¾‹ã€é™æ€å•å…ƒæ•°é‡ã€å±€éƒ¨æ··åˆæ•°é‡ç­‰ã€‚å®ƒé€šè¿‡çº¿æ€§å±‚å’Œå½’ä¸€åŒ–å±‚æ„å»ºäº†ä¸€ä¸ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå¹¶åœ¨å‰å‘ä¼ æ’­ä¸­è®¡ç®—è¾“å…¥çš„æ³¨æ„åŠ›æƒé‡ã€‚

`KWconvNd`ç±»æ˜¯ä¸€ä¸ªé€šç”¨çš„å·ç§¯å±‚ç±»ï¼Œç»§æ‰¿è‡ª`nn.Module`ã€‚å®ƒæ ¹æ®è¾“å…¥å‚æ•°åˆå§‹åŒ–å·ç§¯å±‚çš„å„ç§å±æ€§ï¼Œå¹¶å®šä¹‰äº†`init_attention`æ–¹æ³•æ¥åˆå§‹åŒ–æ³¨æ„åŠ›æœºåˆ¶ã€‚`forward`æ–¹æ³•åˆ™å®ç°äº†å·ç§¯æ“ä½œï¼Œç»“åˆäº†æ³¨æ„åŠ›æƒé‡å’Œä»ä»“åº“ä¸­è·å–çš„å·ç§¯æ ¸ã€‚

æ¥ä¸‹æ¥ï¼Œ`KWConv1d`ã€`KWConv2d`å’Œ`KWConv3d`ç±»åˆ†åˆ«æ˜¯é’ˆå¯¹ä¸€ç»´ã€äºŒç»´å’Œä¸‰ç»´å·ç§¯çš„å…·ä½“å®ç°ï¼Œç»§æ‰¿è‡ª`KWconvNd`ï¼Œå¹¶æŒ‡å®šäº†ç›¸åº”çš„å·ç§¯å‡½æ•°å’Œç»´åº¦ä¿¡æ¯ã€‚

`KWLinear`ç±»å®ç°äº†ä¸€ç»´çº¿æ€§å±‚ï¼Œå†…éƒ¨ä½¿ç”¨äº†`KWConv1d`è¿›è¡Œå·ç§¯æ“ä½œï¼Œæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ¥å£æ¥å¤„ç†çº¿æ€§å˜æ¢ã€‚

`Warehouse_Manager`ç±»æ˜¯æ•´ä¸ªæ¨¡å—çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç®¡ç†å·ç§¯æ ¸çš„ä»“åº“ã€‚å®ƒå…è®¸åŠ¨æ€åˆ›å»ºå·ç§¯å±‚è€Œä¸ç«‹å³åˆ†é…æƒé‡ï¼Œå¹¶åœ¨`store`æ–¹æ³•ä¸­è®¡ç®—å¹¶å­˜å‚¨å·ç§¯æ ¸çš„å½¢çŠ¶å’Œæ•°é‡ã€‚`allocate`æ–¹æ³•åˆ™ç”¨äºåˆ†é…æƒé‡å¹¶åˆå§‹åŒ–ã€‚

`KWConv`ç±»æ˜¯ä¸€ä¸ªå°è£…ç±»ï¼Œç”¨äºåˆ›å»ºå·ç§¯å±‚å¹¶è‡ªåŠ¨åº”ç”¨æ‰¹å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ã€‚å®ƒä¾èµ–äº`Warehouse_Manager`æ¥ç®¡ç†å·ç§¯æ ¸ã€‚

æœ€åï¼Œ`get_temperature`å‡½æ•°ç”¨äºè®¡ç®—æ¸©åº¦å€¼ï¼Œé€šå¸¸åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç”¨äºè°ƒæ•´æ¨¡å‹çš„è¡Œä¸ºï¼Œä»¥æ§åˆ¶æ³¨æ„åŠ›æœºåˆ¶çš„çµæ´»æ€§ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªå¤æ‚çš„å·ç§¯å±‚ç®¡ç†æœºåˆ¶ï¼Œé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å’Œä»“åº“ç®¡ç†çš„æ–¹å¼æ¥ä¼˜åŒ–å·ç§¯æ“ä½œçš„æ•ˆç‡å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºéœ€è¦é«˜æ•ˆå‚æ•°ç®¡ç†çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚

#### 11.2 ultralytics\utils\callbacks\base.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license
"""åŸºç¡€å›è°ƒå‡½æ•°å®šä¹‰æ¨¡å—ã€‚"""

from collections import defaultdict
from copy import deepcopy

# å®šä¹‰è®­ç»ƒè¿‡ç¨‹ä¸­çš„å›è°ƒå‡½æ•°
def on_train_start(trainer):
    """è®­ç»ƒå¼€å§‹æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    pass

def on_train_epoch_start(trainer):
    """æ¯ä¸ªè®­ç»ƒå‘¨æœŸå¼€å§‹æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    pass

def on_train_batch_start(trainer):
    """æ¯ä¸ªè®­ç»ƒæ‰¹æ¬¡å¼€å§‹æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    pass

def on_train_batch_end(trainer):
    """æ¯ä¸ªè®­ç»ƒæ‰¹æ¬¡ç»“æŸæ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    pass

def on_train_epoch_end(trainer):
    """æ¯ä¸ªè®­ç»ƒå‘¨æœŸç»“æŸæ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    pass

def on_train_end(trainer):
    """è®­ç»ƒç»“æŸæ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚"""
    pass

# å®šä¹‰é»˜è®¤å›è°ƒå‡½æ•°å­—å…¸
default_callbacks = {
    'on_train_start': [on_train_start],
    'on_train_epoch_start': [on_train_epoch_start],
    'on_train_batch_start': [on_train_batch_start],
    'on_train_batch_end': [on_train_batch_end],
    'on_train_epoch_end': [on_train_epoch_end],
    'on_train_end': [on_train_end],
}

def get_default_callbacks():
    """
    è¿”å›ä¸€ä¸ªåŒ…å«é»˜è®¤å›è°ƒå‡½æ•°çš„å­—å…¸å‰¯æœ¬ã€‚

    è¿”å›:
        (defaultdict): ä¸€ä¸ªå¸¦æœ‰é»˜è®¤å€¼ä¸ºç©ºåˆ—è¡¨çš„defaultdictã€‚
    """
    return defaultdict(list, deepcopy(default_callbacks))

def add_integration_callbacks(instance):
    """
    å°†æ¥è‡ªä¸åŒæ¥æºçš„é›†æˆå›è°ƒæ·»åŠ åˆ°å®ä¾‹çš„å›è°ƒä¸­ã€‚

    å‚æ•°:
        instance (Trainer, Predictor, Validator, Exporter): ä¸€ä¸ªå…·æœ‰'callbacks'å±æ€§çš„å¯¹è±¡ï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ªå›è°ƒåˆ—è¡¨çš„å­—å…¸ã€‚
    """
    # åŠ è½½å…¶ä»–å›è°ƒï¼ˆä¾‹å¦‚æ¥è‡ªHUBçš„å›è°ƒï¼‰
    from .hub import callbacks as hub_cb
    callbacks_list = [hub_cb]

    # å¦‚æœå®ä¾‹æ˜¯Trainerç±»å‹ï¼ŒåŠ è½½æ›´å¤šè®­ç»ƒå›è°ƒ
    if 'Trainer' in instance.__class__.__name__:
        from .clearml import callbacks as clear_cb
        callbacks_list.extend([clear_cb])  # è¿™é‡Œåªç¤ºä¾‹åŠ è½½ä¸€ä¸ªå›è°ƒ

    # å°†åŠ è½½çš„å›è°ƒæ·»åŠ åˆ°å®ä¾‹çš„å›è°ƒå­—å…¸ä¸­
    for callbacks in callbacks_list:
        for k, v in callbacks.items():
            if v not in instance.callbacks[k]:
                instance.callbacks[k].append(v)
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **æ¨¡å—å¯¼å…¥**ï¼šå¯¼å…¥äº†`defaultdict`å’Œ`deepcopy`ï¼Œç”¨äºåˆ›å»ºå¸¦æœ‰é»˜è®¤å€¼çš„å­—å…¸å’Œæ·±æ‹·è´ã€‚
2. **å›è°ƒå‡½æ•°å®šä¹‰**ï¼šå®šä¹‰äº†ä¸€ç³»åˆ—å›è°ƒå‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨è®­ç»ƒçš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ï¼Œä¾‹å¦‚è®­ç»ƒå¼€å§‹ã€æ¯ä¸ªå‘¨æœŸå¼€å§‹ã€æ¯ä¸ªæ‰¹æ¬¡å¼€å§‹å’Œç»“æŸç­‰ã€‚
3. **é»˜è®¤å›è°ƒå­—å…¸**ï¼š`default_callbacks`å­—å…¸å­˜å‚¨äº†æ‰€æœ‰å®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚
4. **è·å–é»˜è®¤å›è°ƒå‡½æ•°**ï¼š`get_default_callbacks`å‡½æ•°è¿”å›ä¸€ä¸ªé»˜è®¤å›è°ƒå­—å…¸çš„å‰¯æœ¬ï¼Œç¡®ä¿æ¯æ¬¡è°ƒç”¨æ—¶éƒ½å¾—åˆ°ä¸€ä¸ªæ–°çš„å­—å…¸ã€‚
5. **æ·»åŠ é›†æˆå›è°ƒ**ï¼š`add_integration_callbacks`å‡½æ•°ç”¨äºå°†æ¥è‡ªä¸åŒæ¥æºçš„å›è°ƒå‡½æ•°æ·»åŠ åˆ°å®ä¾‹çš„å›è°ƒå­—å…¸ä¸­ï¼Œæ”¯æŒæ‰©å±•å’Œé›†æˆå…¶ä»–åŠŸèƒ½ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `ultralytics/utils/callbacks/base.py` æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œç®¡ç†å›è°ƒå‡½æ•°çš„åŸºç¡€æ¨¡å—ï¼Œä¸»è¦ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒã€éªŒè¯ã€é¢„æµ‹å’Œå¯¼å‡ºè¿‡ç¨‹ã€‚å›è°ƒå‡½æ•°æ˜¯åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—ã€è°ƒæ•´å­¦ä¹ ç‡ã€ä¿å­˜æ¨¡å‹ç­‰ã€‚

æ–‡ä»¶ä¸­é¦–å…ˆå¯¼å…¥äº† `defaultdict` å’Œ `deepcopy`ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—åˆ†åˆ«ç”¨äºåˆ›å»ºä¸€ä¸ªå…·æœ‰é»˜è®¤å€¼çš„å­—å…¸å’Œæ·±æ‹·è´å¯¹è±¡ã€‚æ¥ä¸‹æ¥ï¼Œæ–‡ä»¶å®šä¹‰äº†ä¸€ç³»åˆ—å›è°ƒå‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¢«åˆ†ä¸ºå››ä¸ªä¸»è¦éƒ¨åˆ†ï¼šè®­ç»ƒå›è°ƒã€éªŒè¯å›è°ƒã€é¢„æµ‹å›è°ƒå’Œå¯¼å‡ºå›è°ƒã€‚

åœ¨è®­ç»ƒå›è°ƒéƒ¨åˆ†ï¼Œå®šä¹‰äº†å¤šä¸ªå‡½æ•°ï¼Œä¾‹å¦‚ `on_train_start`ã€`on_train_epoch_start`ã€`on_train_batch_start` ç­‰ã€‚è¿™äº›å‡½æ•°åœ¨è®­ç»ƒçš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ï¼Œå…è®¸å¼€å‘è€…åœ¨è®­ç»ƒå¼€å§‹ã€æ¯ä¸ªepochå¼€å§‹ã€æ¯ä¸ªbatchå¼€å§‹å’Œç»“æŸæ—¶æ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚è¿˜æœ‰ä¸€äº›å‡½æ•°å¦‚ `optimizer_step` å’Œ `on_before_zero_grad`ï¼Œåˆ†åˆ«åœ¨ä¼˜åŒ–å™¨æ›´æ–°å’Œæ¢¯åº¦æ¸…é›¶ä¹‹å‰è¢«è°ƒç”¨ã€‚

éªŒè¯å›è°ƒéƒ¨åˆ†ç±»ä¼¼ï¼Œå®šä¹‰äº† `on_val_start`ã€`on_val_batch_start`ã€`on_val_batch_end` å’Œ `on_val_end` ç­‰å‡½æ•°ï¼Œç”¨äºåœ¨éªŒè¯è¿‡ç¨‹çš„ä¸åŒé˜¶æ®µæ‰§è¡Œç‰¹å®šæ“ä½œã€‚

é¢„æµ‹å›è°ƒéƒ¨åˆ†åŒ…å«äº†ä¸é¢„æµ‹ç›¸å…³çš„å‡½æ•°ï¼Œå¦‚ `on_predict_start`ã€`on_predict_batch_start`ã€`on_predict_batch_end` å’Œ `on_predict_end`ï¼Œè¿™äº›å‡½æ•°åœ¨è¿›è¡Œæ¨¡å‹é¢„æµ‹æ—¶è¢«è°ƒç”¨ã€‚

å¯¼å‡ºå›è°ƒéƒ¨åˆ†åˆ™å®šä¹‰äº† `on_export_start` å’Œ `on_export_end`ï¼Œç”¨äºåœ¨æ¨¡å‹å¯¼å‡ºè¿‡ç¨‹çš„å¼€å§‹å’Œç»“æŸæ—¶æ‰§è¡Œæ“ä½œã€‚

åœ¨æ–‡ä»¶çš„æœ€åï¼Œå®šä¹‰äº†ä¸€ä¸ª `default_callbacks` å­—å…¸ï¼Œæ±‡æ€»äº†æ‰€æœ‰çš„å›è°ƒå‡½æ•°ï¼Œä¾¿äºåç»­ä½¿ç”¨ã€‚`get_default_callbacks` å‡½æ•°è¿”å›ä¸€ä¸ªæ·±æ‹·è´çš„ `default_callbacks` å­—å…¸ï¼Œç¡®ä¿æ¯æ¬¡è°ƒç”¨éƒ½è¿”å›ä¸€ä¸ªæ–°çš„å­—å…¸å®ä¾‹ï¼Œé¿å…å¯¹åŸå§‹å­—å…¸çš„ä¿®æ”¹ã€‚

æ­¤å¤–ï¼Œ`add_integration_callbacks` å‡½æ•°ç”¨äºå°†æ¥è‡ªä¸åŒæ¥æºçš„é›†æˆå›è°ƒæ·»åŠ åˆ°å®ä¾‹çš„å›è°ƒå­—å…¸ä¸­ã€‚è¯¥å‡½æ•°ä¼šæ ¹æ®ä¼ å…¥çš„å®ä¾‹ç±»å‹ï¼ˆå¦‚ Trainerã€Predictorã€Validatorã€Exporterï¼‰åŠ è½½ç›¸åº”çš„å›è°ƒï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°å®ä¾‹çš„å›è°ƒåˆ—è¡¨ä¸­ã€‚è¿™ç§è®¾è®¡ä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°æ‰©å±•å’Œé›†æˆå„ç§å›è°ƒï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸º Ultralytics YOLO æä¾›äº†ä¸€ä¸ªçµæ´»çš„å›è°ƒæœºåˆ¶ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨è®­ç»ƒã€éªŒè¯ã€é¢„æµ‹å’Œå¯¼å‡ºè¿‡ç¨‹ä¸­è‡ªå®šä¹‰è¡Œä¸ºï¼Œä»è€Œæé«˜æ¨¡å‹è®­ç»ƒå’Œä½¿ç”¨çš„çµæ´»æ€§å’Œå¯æ§æ€§ã€‚

#### 11.3 ultralytics\models\yolo\segment\predict.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
from ultralytics.engine.results import Results  # å¯¼å…¥ç»“æœå¤„ç†ç±»
from ultralytics.models.yolo.detect.predict import DetectionPredictor  # å¯¼å…¥æ£€æµ‹é¢„æµ‹ç±»
from ultralytics.utils import DEFAULT_CFG, ops  # å¯¼å…¥é»˜è®¤é…ç½®å’Œæ“ä½œå·¥å…·

class SegmentationPredictor(DetectionPredictor):
    """
    æ‰©å±•DetectionPredictorç±»ï¼Œç”¨äºåŸºäºåˆ†å‰²æ¨¡å‹çš„é¢„æµ‹ã€‚
    """

    def __init__(self, cfg=DEFAULT_CFG, overrides=None, _callbacks=None):
        """åˆå§‹åŒ–SegmentationPredictorï¼Œè®¾ç½®é…ç½®ã€è¦†ç›–å‚æ•°å’Œå›è°ƒå‡½æ•°ã€‚"""
        super().__init__(cfg, overrides, _callbacks)  # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        self.args.task = 'segment'  # è®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºåˆ†å‰²

    def postprocess(self, preds, img, orig_imgs):
        """å¯¹æ¯ä¸ªè¾“å…¥å›¾åƒæ‰¹æ¬¡çš„é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ï¼ŒåŒ…æ‹¬éæå¤§å€¼æŠ‘åˆ¶å’Œæ£€æµ‹å¤„ç†ã€‚"""
        # åº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼Œè¿‡æ»¤æ‰ä½ç½®ä¿¡åº¦çš„æ£€æµ‹æ¡†
        p = ops.non_max_suppression(preds[0],
                                    self.args.conf,  # ç½®ä¿¡åº¦é˜ˆå€¼
                                    self.args.iou,  # IOUé˜ˆå€¼
                                    agnostic=self.args.agnostic_nms,  # æ˜¯å¦ç±»åˆ«æ— å…³çš„NMS
                                    max_det=self.args.max_det,  # æœ€å¤§æ£€æµ‹æ¡†æ•°é‡
                                    nc=len(self.model.names),  # ç±»åˆ«æ•°é‡
                                    classes=self.args.classes)  # é€‰æ‹©çš„ç±»åˆ«

        # å¦‚æœè¾“å…¥å›¾åƒä¸æ˜¯åˆ—è¡¨ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºnumpyæ•°ç»„
        if not isinstance(orig_imgs, list):
            orig_imgs = ops.convert_torch2numpy_batch(orig_imgs)

        results = []  # å­˜å‚¨ç»“æœçš„åˆ—è¡¨
        proto = preds[1][-1] if len(preds[1]) == 3 else preds[1]  # è·å–åˆ†å‰²æ©ç çš„åŸå‹

        # éå†æ¯ä¸ªé¢„æµ‹ç»“æœ
        for i, pred in enumerate(p):
            orig_img = orig_imgs[i]  # è·å–åŸå§‹å›¾åƒ
            img_path = self.batch[0][i]  # è·å–å›¾åƒè·¯å¾„
            
            if not len(pred):  # å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°æ¡†
                masks = None  # æ©ç ä¸ºNone
            elif self.args.retina_masks:  # å¦‚æœä½¿ç”¨Retinaæ©ç 
                # ç¼©æ”¾æ£€æµ‹æ¡†åˆ°åŸå§‹å›¾åƒçš„å°ºå¯¸
                pred[:, :4] = ops.scale_boxes(img.shape[2:], pred[:, :4], orig_img.shape)
                # å¤„ç†æ©ç 
                masks = ops.process_mask_native(proto[i], pred[:, 6:], pred[:, :4], orig_img.shape[:2])  # HWC
            else:  # å¦åˆ™ä½¿ç”¨å¸¸è§„æ©ç å¤„ç†
                masks = ops.process_mask(proto[i], pred[:, 6:], pred[:, :4], img.shape[2:], upsample=True)  # HWC
                # ç¼©æ”¾æ£€æµ‹æ¡†åˆ°åŸå§‹å›¾åƒçš„å°ºå¯¸
                pred[:, :4] = ops.scale_boxes(img.shape[2:], pred[:, :4], orig_img.shape)
            
            # å°†ç»“æœæ·»åŠ åˆ°ç»“æœåˆ—è¡¨ä¸­
            results.append(Results(orig_img, path=img_path, names=self.model.names, boxes=pred[:, :6], masks=masks))
        
        return results  # è¿”å›å¤„ç†åçš„ç»“æœ
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **ç±»å®šä¹‰**ï¼š`SegmentationPredictor` ç»§æ‰¿è‡ª `DetectionPredictor`ï¼Œç”¨äºå®ç°å›¾åƒåˆ†å‰²çš„é¢„æµ‹åŠŸèƒ½ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**ï¼šåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°å¹¶è®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºåˆ†å‰²ã€‚
3. **åå¤„ç†æ–¹æ³•**ï¼š`postprocess` æ–¹æ³•è´Ÿè´£å¯¹æ¨¡å‹çš„é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ï¼ŒåŒ…æ‹¬ï¼š
   - åº”ç”¨éæå¤§å€¼æŠ‘åˆ¶æ¥è¿‡æ»¤ä½ç½®ä¿¡åº¦çš„æ£€æµ‹æ¡†ã€‚
   - å°†è¾“å…¥å›¾åƒè½¬æ¢ä¸ºnumpyæ•°ç»„ï¼ˆå¦‚æœä¸æ˜¯åˆ—è¡¨ï¼‰ã€‚
   - å¤„ç†æ¯ä¸ªé¢„æµ‹ç»“æœï¼Œç”Ÿæˆæœ€ç»ˆçš„æ©ç å’Œæ£€æµ‹æ¡†ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨åˆ—è¡¨ä¸­ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨äºå›¾åƒåˆ†å‰²çš„é¢„æµ‹ç±»ï¼Œåä¸º `SegmentationPredictor`ï¼Œå®ƒç»§æ‰¿è‡ª `DetectionPredictor` ç±»ã€‚è¿™ä¸ªç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯åŸºäºåˆ†å‰²æ¨¡å‹è¿›è¡Œå›¾åƒé¢„æµ‹ã€‚æ–‡ä»¶å¼€å¤´åŒ…å«äº†ç‰ˆæƒä¿¡æ¯å’Œå¿…è¦çš„æ¨¡å—å¯¼å…¥ï¼ŒåŒ…æ‹¬ `Results` ç±»ã€`DetectionPredictor` ç±»å’Œä¸€äº›å·¥å…·å‡½æ•°ã€‚

åœ¨ `SegmentationPredictor` ç±»çš„æ„é€ å‡½æ•° `__init__` ä¸­ï¼Œè°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå¹¶è®¾ç½®äº†ä»»åŠ¡ç±»å‹ä¸º 'segment'ï¼Œè¿™è¡¨æ˜è¯¥ç±»ä¸“æ³¨äºå›¾åƒåˆ†å‰²ä»»åŠ¡ã€‚æ„é€ å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šé…ç½®ï¼ˆ`cfg`ï¼‰ã€è¦†ç›–å‚æ•°ï¼ˆ`overrides`ï¼‰å’Œå›è°ƒå‡½æ•°ï¼ˆ`_callbacks`ï¼‰ï¼Œå…¶ä¸­é…ç½®å‚æ•°é»˜è®¤ä¸º `DEFAULT_CFG`ã€‚

`postprocess` æ–¹æ³•æ˜¯è¯¥ç±»çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒè´Ÿè´£å¯¹æ¨¡å‹çš„é¢„æµ‹ç»“æœè¿›è¡Œåå¤„ç†ã€‚é¦–å…ˆï¼Œå®ƒè°ƒç”¨ `ops.non_max_suppression` å‡½æ•°å¯¹é¢„æµ‹ç»“æœè¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶ï¼Œä»¥å‡å°‘å†—ä½™çš„æ£€æµ‹æ¡†ã€‚è¯¥å‡½æ•°ä½¿ç”¨äº†ä¸€äº›å‚æ•°ï¼Œå¦‚ç½®ä¿¡åº¦é˜ˆå€¼ã€IOUé˜ˆå€¼ã€æ˜¯å¦ä½¿ç”¨ç±»åˆ«æ— å…³çš„NMSç­‰ã€‚

æ¥ä¸‹æ¥ï¼Œæ–¹æ³•æ£€æŸ¥è¾“å…¥çš„åŸå§‹å›¾åƒæ˜¯å¦ä¸ºåˆ—è¡¨æ ¼å¼ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºNumPyæ•°ç»„æ ¼å¼ã€‚ç„¶åï¼Œç¨‹åºæ ¹æ®é¢„æµ‹ç»“æœçš„ç»“æ„å¤„ç†æ©è†œæ•°æ®ã€‚å®ƒä»é¢„æµ‹ç»“æœä¸­æå–åŸå§‹å›¾åƒè·¯å¾„ï¼Œå¹¶æ ¹æ®é¢„æµ‹æ¡†çš„æ•°é‡å†³å®šæ˜¯å¦ç”Ÿæˆæ©è†œã€‚å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ä»»ä½•ç›®æ ‡ï¼Œæ©è†œå°†è¢«è®¾ç½®ä¸º `None`ï¼›å¦‚æœå¯ç”¨äº† `retina_masks`ï¼Œåˆ™ä½¿ç”¨ä¸åŒçš„å¤„ç†æ–¹å¼ç”Ÿæˆæ©è†œã€‚

æœ€åï¼Œç¨‹åºå°†å¤„ç†åçš„ç»“æœå°è£…åˆ° `Results` å¯¹è±¡ä¸­ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç»“æœåˆ—è¡¨ä¸­ã€‚è¿™ä¸ªç»“æœåˆ—è¡¨å°†åŒ…å«æ¯å¼ å›¾åƒçš„åŸå§‹å›¾åƒã€è·¯å¾„ã€ç±»åˆ«åç§°ã€æ£€æµ‹æ¡†å’Œæ©è†œï¼Œæœ€ç»ˆè¿”å›è¿™ä¸ªç»“æœåˆ—è¡¨ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªç”¨äºå›¾åƒåˆ†å‰²çš„é¢„æµ‹å™¨ï¼Œèƒ½å¤Ÿå¯¹è¾“å…¥å›¾åƒè¿›è¡Œå¤„ç†ã€ç”Ÿæˆé¢„æµ‹ç»“æœå¹¶è¿”å›ç›¸åº”çš„æ ¼å¼ï¼Œä¾¿äºåç»­çš„åˆ†æå’Œåº”ç”¨ã€‚

#### 11.4 ultralytics\utils\callbacks\dvc.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å¹¶æ·»åŠ è¯¦ç»†ä¸­æ–‡æ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
# å¯¼å…¥å¿…è¦çš„åº“
from ultralytics.utils import LOGGER, SETTINGS, TESTS_RUNNING, checks

try:
    # ç¡®ä¿æ²¡æœ‰åœ¨è¿è¡Œæµ‹è¯•
    assert not TESTS_RUNNING  
    # ç¡®ä¿DVCé›†æˆå·²å¯ç”¨
    assert SETTINGS['dvc'] is True  
    import dvclive  # å¯¼å…¥DVCLiveåº“
    # æ£€æŸ¥DVCLiveç‰ˆæœ¬
    assert checks.check_version('dvclive', '2.11.0', verbose=True)

    import os
    import re
    from pathlib import Path

    # DVCLiveæ—¥å¿—è®°å½•å®ä¾‹
    live = None
    _processed_plots = {}  # è®°å½•å·²å¤„ç†çš„å›¾è¡¨

    # ç”¨äºåŒºåˆ†æœ€ä½³æ¨¡å‹çš„æœ€ç»ˆè¯„ä¼°ä¸æœ€åä¸€ä¸ªepochéªŒè¯çš„æ ‡å¿—
    _training_epoch = False

except (ImportError, AssertionError, TypeError):
    dvclive = None  # å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œåˆ™å°†dvcliveè®¾ç½®ä¸ºNone


def _log_images(path, prefix=''):
    """è®°å½•æŒ‡å®šè·¯å¾„çš„å›¾åƒï¼Œä½¿ç”¨DVCLiveå¹¶å¯é€‰å‰ç¼€ã€‚"""
    if live:  # å¦‚æœDVCLiveå®ä¾‹å­˜åœ¨
        name = path.name  # è·å–å›¾åƒæ–‡ä»¶å

        # æ ¹æ®æ‰¹æ¬¡åˆ†ç»„å›¾åƒï¼Œä»¥ä¾¿åœ¨UIä¸­å¯ç”¨æ»‘å—
        m = re.search(r'_batch(\d+)', name)
        if m:
            ni = m[1]  # è·å–æ‰¹æ¬¡å·
            new_stem = re.sub(r'_batch(\d+)', '_batch', path.stem)  # æ›¿æ¢æ–‡ä»¶åä¸­çš„æ‰¹æ¬¡å·
            name = (Path(new_stem) / ni).with_suffix(path.suffix)  # ç”Ÿæˆæ–°çš„æ–‡ä»¶å

        live.log_image(os.path.join(prefix, name), path)  # è®°å½•å›¾åƒ


def on_train_start(trainer):
    """å¦‚æœDVCLiveæ—¥å¿—è®°å½•å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™è®°å½•è®­ç»ƒå‚æ•°ã€‚"""
    if live:
        live.log_params(trainer.args)  # è®°å½•è®­ç»ƒå‚æ•°


def on_fit_epoch_end(trainer):
    """åœ¨æ¯ä¸ªè®­ç»ƒepochç»“æŸæ—¶è®°å½•è®­ç»ƒæŒ‡æ ‡å’Œæ¨¡å‹ä¿¡æ¯ã€‚"""
    global _training_epoch
    if live and _training_epoch:  # å¦‚æœDVCLiveå­˜åœ¨ä¸”æ­£åœ¨è®­ç»ƒepoch
        all_metrics = {**trainer.label_loss_items(trainer.tloss, prefix='train'), **trainer.metrics, **trainer.lr}
        for metric, value in all_metrics.items():
            live.log_metric(metric, value)  # è®°å½•æ¯ä¸ªæŒ‡æ ‡çš„å€¼

        _training_epoch = False  # é‡ç½®è®­ç»ƒepochæ ‡å¿—


def on_train_end(trainer):
    """åœ¨è®­ç»ƒç»“æŸæ—¶è®°å½•æœ€ä½³æŒ‡æ ‡ã€å›¾è¡¨å’Œæ··æ·†çŸ©é˜µã€‚"""
    if live:
        all_metrics = {**trainer.label_loss_items(trainer.tloss, prefix='train'), **trainer.metrics, **trainer.lr}
        for metric, value in all_metrics.items():
            live.log_metric(metric, value, plot=False)  # è®°å½•æœ€ä½³æŒ‡æ ‡

        # è®°å½•æ··æ·†çŸ©é˜µ
        _log_confusion_matrix(trainer.validator)

        live.end()  # ç»“æŸDVCLiveè®°å½•


# å®šä¹‰å›è°ƒå‡½æ•°
callbacks = {
    'on_train_start': on_train_start,
    'on_fit_epoch_end': on_fit_epoch_end,
    'on_train_end': on_train_end
} if dvclive else {}
```

### ä»£ç è¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼šå¯¼å…¥å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ—¥å¿—è®°å½•å’Œè®¾ç½®ã€‚
2. **å¼‚å¸¸å¤„ç†**ï¼šå°è¯•å¯¼å…¥DVCLiveå¹¶è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥ï¼Œå¦‚æœå¤±è´¥åˆ™å°†å…¶è®¾ç½®ä¸ºNoneã€‚
3. **æ—¥å¿—è®°å½•å‡½æ•°**ï¼š
   - `_log_images`ï¼šè®°å½•å›¾åƒåˆ°DVCLiveã€‚
   - `on_train_start`ï¼šåœ¨è®­ç»ƒå¼€å§‹æ—¶è®°å½•å‚æ•°ã€‚
   - `on_fit_epoch_end`ï¼šåœ¨æ¯ä¸ªè®­ç»ƒepochç»“æŸæ—¶è®°å½•æŒ‡æ ‡ã€‚
   - `on_train_end`ï¼šåœ¨è®­ç»ƒç»“æŸæ—¶è®°å½•æœ€ä½³æŒ‡æ ‡å’Œæ··æ·†çŸ©é˜µã€‚
4. **å›è°ƒå‡½æ•°**ï¼šæ ¹æ®DVCLiveçš„çŠ¶æ€å®šä¹‰å›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨è°ƒç”¨ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOæ¡†æ¶ä¸­çš„ä¸€ä¸ªå›è°ƒæ¨¡å—ï¼Œä¸»è¦ç”¨äºé›†æˆDVCLiveè¿›è¡Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„æ—¥å¿—è®°å½•å’Œå¯è§†åŒ–ã€‚é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„æ¨¡å—å’Œåº“ï¼ŒåŒ…æ‹¬æ—¥å¿—è®°å½•å™¨ã€è®¾ç½®å’Œæ£€æŸ¥å‡½æ•°ã€‚å®ƒè¿˜å°è¯•å¯¼å…¥dvcliveåº“ï¼Œå¹¶è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥ï¼Œç¡®ä¿é›†æˆæ˜¯å¯ç”¨çš„ã€‚

åœ¨æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œå¦‚`live`ï¼ˆDVCLiveçš„å®ä¾‹ï¼‰å’Œ`_processed_plots`ï¼ˆç”¨äºè·Ÿè¸ªå·²å¤„ç†çš„å›¾è¡¨ï¼‰ã€‚åŒæ—¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¸ƒå°”å˜é‡`_training_epoch`ï¼Œç”¨äºæ ‡è¯†å½“å‰æ˜¯å¦å¤„äºè®­ç»ƒå‘¨æœŸçš„å¼€å§‹ã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†ä¸€äº›ç§æœ‰å‡½æ•°ç”¨äºè®°å½•ä¸åŒç±»å‹çš„æ•°æ®ã€‚`_log_images`å‡½æ•°ç”¨äºè®°å½•æŒ‡å®šè·¯å¾„ä¸‹çš„å›¾åƒï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ å‰ç¼€ã€‚`_log_plots`å‡½æ•°ç”¨äºè®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„å›¾è¡¨ï¼Œå¦‚æœå›¾è¡¨æœªè¢«å¤„ç†è¿‡ï¼Œåˆ™è¿›è¡Œè®°å½•ã€‚`_log_confusion_matrix`å‡½æ•°ç”¨äºè®°å½•æ··æ·†çŸ©é˜µï¼Œæä¾›ç›®æ ‡å’Œé¢„æµ‹çš„è¯¦ç»†ä¿¡æ¯ã€‚

ç„¶åï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—å›è°ƒå‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨è®­ç»ƒçš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ã€‚`on_pretrain_routine_start`å‡½æ•°åœ¨é¢„è®­ç»ƒå¼€å§‹æ—¶åˆå§‹åŒ–DVCLiveè®°å½•å™¨ï¼Œå¹¶è®°å½•ç›¸å…³ä¿¡æ¯ã€‚`on_pretrain_routine_end`å‡½æ•°åœ¨é¢„è®­ç»ƒç»“æŸæ—¶è®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„å›¾è¡¨ã€‚`on_train_start`å‡½æ•°åœ¨è®­ç»ƒå¼€å§‹æ—¶è®°å½•è®­ç»ƒå‚æ•°ã€‚

`on_train_epoch_start`å‡½æ•°åœ¨æ¯ä¸ªè®­ç»ƒå‘¨æœŸå¼€å§‹æ—¶è®¾ç½®`_training_epoch`ä¸ºTrueï¼Œè¡¨ç¤ºå½“å‰å¤„äºè®­ç»ƒå‘¨æœŸã€‚`on_fit_epoch_end`å‡½æ•°åœ¨æ¯ä¸ªè®­ç»ƒå‘¨æœŸç»“æŸæ—¶è®°å½•è®­ç»ƒæŒ‡æ ‡å’Œæ¨¡å‹ä¿¡æ¯ï¼Œå¹¶æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚æœ€åï¼Œ`on_train_end`å‡½æ•°åœ¨è®­ç»ƒç»“æŸæ—¶è®°å½•æœ€ä½³æŒ‡æ ‡ã€å›¾è¡¨å’Œæ··æ·†çŸ©é˜µï¼Œå¹¶ç»“æŸDVCLiveè®°å½•ã€‚

æœ€åï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå­—å…¸`callbacks`ï¼Œæ ¹æ®DVCLiveæ˜¯å¦å¯ç”¨æ¥å†³å®šå›è°ƒå‡½æ•°çš„æ³¨å†Œã€‚è¿™äº›å›è°ƒå‡½æ•°å°†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¢«è§¦å‘ï¼Œä»¥ä¾¿è¿›è¡Œç›¸åº”çš„æ—¥å¿—è®°å½•å’Œå¯è§†åŒ–ã€‚æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ¨¡å—çš„ç›®çš„æ˜¯å¢å¼ºè®­ç»ƒè¿‡ç¨‹çš„å¯è§†åŒ–å’Œå¯è¿½æº¯æ€§ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œåˆ†ææ¨¡å‹çš„è®­ç»ƒæƒ…å†µã€‚

#### 11.5 ultralytics\nn\backbone\convnextv2.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F

class LayerNorm(nn.Module):
    """ 
    è‡ªå®šä¹‰çš„LayerNormå±‚ï¼Œæ”¯æŒä¸¤ç§æ•°æ®æ ¼å¼ï¼šchannels_lastï¼ˆé»˜è®¤ï¼‰å’Œchannels_firstã€‚
    channels_lastå¯¹åº”è¾“å…¥å½¢çŠ¶ä¸º(batch_size, height, width, channels)ï¼Œ
    è€Œchannels_firstå¯¹åº”è¾“å…¥å½¢çŠ¶ä¸º(batch_size, channels, height, width)ã€‚
    """
    def __init__(self, normalized_shape, eps=1e-6, data_format="channels_last"):
        super().__init__()
        # æƒé‡å’Œåç½®åˆå§‹åŒ–
        self.weight = nn.Parameter(torch.ones(normalized_shape))
        self.bias = nn.Parameter(torch.zeros(normalized_shape))
        self.eps = eps
        self.data_format = data_format
        if self.data_format not in ["channels_last", "channels_first"]:
            raise NotImplementedError 
        self.normalized_shape = (normalized_shape, )
    
    def forward(self, x):
        # æ ¹æ®æ•°æ®æ ¼å¼é€‰æ‹©ä¸åŒçš„å½’ä¸€åŒ–æ–¹å¼
        if self.data_format == "channels_last":
            return F.layer_norm(x, self.normalized_shape, self.weight, self.bias, self.eps)
        elif self.data_format == "channels_first":
            u = x.mean(1, keepdim=True)  # è®¡ç®—å‡å€¼
            s = (x - u).pow(2).mean(1, keepdim=True)  # è®¡ç®—æ–¹å·®
            x = (x - u) / torch.sqrt(s + self.eps)  # å½’ä¸€åŒ–
            x = self.weight[:, None, None] * x + self.bias[:, None, None]  # åº”ç”¨æƒé‡å’Œåç½®
            return x

class Block(nn.Module):
    """ 
    ConvNeXtV2çš„åŸºæœ¬æ¨¡å—ï¼ŒåŒ…å«æ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€å½’ä¸€åŒ–ã€æ¿€æ´»å‡½æ•°ç­‰ã€‚
    
    Args:
        dim (int): è¾“å…¥é€šé“æ•°ã€‚
    """
    def __init__(self, dim):
        super().__init__()
        # æ·±åº¦å¯åˆ†ç¦»å·ç§¯
        self.dwconv = nn.Conv2d(dim, dim, kernel_size=7, padding=3, groups=dim)
        self.norm = LayerNorm(dim, eps=1e-6)  # è‡ªå®šä¹‰LayerNorm
        self.pwconv1 = nn.Linear(dim, 4 * dim)  # 1x1å·ç§¯ï¼Œä½¿ç”¨çº¿æ€§å±‚å®ç°
        self.act = nn.GELU()  # GELUæ¿€æ´»å‡½æ•°
        self.pwconv2 = nn.Linear(4 * dim, dim)  # 1x1å·ç§¯ï¼Œä½¿ç”¨çº¿æ€§å±‚å®ç°

    def forward(self, x):
        input = x  # ä¿å­˜è¾“å…¥ä»¥ä¾¿åç»­æ®‹å·®è¿æ¥
        x = self.dwconv(x)  # æ·±åº¦å¯åˆ†ç¦»å·ç§¯
        x = self.norm(x)  # å½’ä¸€åŒ–
        x = self.pwconv1(x)  # ç¬¬ä¸€ä¸ª1x1å·ç§¯
        x = self.act(x)  # æ¿€æ´»
        x = self.pwconv2(x)  # ç¬¬äºŒä¸ª1x1å·ç§¯
        x = input + x  # æ®‹å·®è¿æ¥
        return x

class ConvNeXtV2(nn.Module):
    """ 
    ConvNeXt V2æ¨¡å‹å®šä¹‰ã€‚
    
    Args:
        in_chans (int): è¾“å…¥å›¾åƒçš„é€šé“æ•°ã€‚é»˜è®¤å€¼ï¼š3
        num_classes (int): åˆ†ç±»å¤´çš„ç±»åˆ«æ•°ã€‚é»˜è®¤å€¼ï¼š1000
        depths (tuple(int)): æ¯ä¸ªé˜¶æ®µçš„å—æ•°ã€‚é»˜è®¤å€¼ï¼š[3, 3, 9, 3]
        dims (int): æ¯ä¸ªé˜¶æ®µçš„ç‰¹å¾ç»´åº¦ã€‚é»˜è®¤å€¼ï¼š[96, 192, 384, 768]
    """
    def __init__(self, in_chans=3, num_classes=1000, 
                 depths=[3, 3, 9, 3], dims=[96, 192, 384, 768]):
        super().__init__()
        self.downsample_layers = nn.ModuleList()  # ä¸‹é‡‡æ ·å±‚åˆ—è¡¨
        # åˆå§‹å·ç§¯å±‚
        stem = nn.Sequential(
            nn.Conv2d(in_chans, dims[0], kernel_size=4, stride=4),
            LayerNorm(dims[0], eps=1e-6, data_format="channels_first")
        )
        self.downsample_layers.append(stem)
        # æ·»åŠ ä¸‹é‡‡æ ·å±‚
        for i in range(3):
            downsample_layer = nn.Sequential(
                    LayerNorm(dims[i], eps=1e-6, data_format="channels_first"),
                    nn.Conv2d(dims[i], dims[i+1], kernel_size=2, stride=2),
            )
            self.downsample_layers.append(downsample_layer)

        self.stages = nn.ModuleList()  # ç‰¹å¾åˆ†è¾¨ç‡é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µåŒ…å«å¤šä¸ªæ®‹å·®å—
        for i in range(4):
            stage = nn.Sequential(
                *[Block(dim=dims[i]) for _ in range(depths[i])]
            )
            self.stages.append(stage)

        self.norm = nn.LayerNorm(dims[-1], eps=1e-6)  # æœ€åçš„å½’ä¸€åŒ–å±‚
        self.head = nn.Linear(dims[-1], num_classes)  # åˆ†ç±»å¤´

    def forward(self, x):
        for i in range(4):
            x = self.downsample_layers[i](x)  # ä¸‹é‡‡æ ·
            x = self.stages[i](x)  # ç‰¹å¾æå–
        return x  # è¿”å›æœ€åçš„ç‰¹å¾å›¾
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **LayerNorm**: è‡ªå®šä¹‰çš„å±‚å½’ä¸€åŒ–å®ç°ï¼Œæ”¯æŒä¸åŒçš„è¾“å…¥æ ¼å¼ã€‚
2. **Block**: ConvNeXtV2çš„åŸºæœ¬æ„å»ºå—ï¼ŒåŒ…å«æ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€å½’ä¸€åŒ–å’Œæ¿€æ´»å‡½æ•°ï¼Œä½¿ç”¨æ®‹å·®è¿æ¥ã€‚
3. **ConvNeXtV2**: æ•´ä¸ªæ¨¡å‹çš„å®šä¹‰ï¼ŒåŒ…å«å¤šä¸ªä¸‹é‡‡æ ·å±‚å’Œç‰¹å¾æå–é˜¶æ®µï¼Œæœ€ç»ˆè¾“å‡ºåˆ†ç±»ç»“æœã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º `ConvNeXtV2` çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸»è¦ç”¨äºå›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚æ–‡ä»¶ä¸­åŒ…å«å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œæ„æˆäº†è¿™ä¸ªæ¨¡å‹çš„åŸºç¡€æ¶æ„ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ PyTorch å’Œä¸€äº›è‡ªå®šä¹‰çš„å±‚ã€‚æ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†å®šä¹‰äº†ä¸€äº›æ¨¡å‹çš„åç§°ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨ã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†ä¸€ä¸ª `LayerNorm` ç±»ï¼Œå®ƒå®ç°äº†å±‚å½’ä¸€åŒ–åŠŸèƒ½ï¼Œæ”¯æŒä¸¤ç§æ•°æ®æ ¼å¼ï¼š`channels_last` å’Œ `channels_first`ã€‚è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°æ¥å—å½’ä¸€åŒ–çš„å½¢çŠ¶ã€ä¸€ä¸ªå°çš„å¸¸æ•° `eps` ç”¨äºæ•°å€¼ç¨³å®šæ€§ï¼Œä»¥åŠæ•°æ®æ ¼å¼ã€‚`forward` æ–¹æ³•æ ¹æ®è¾“å…¥çš„æ•°æ®æ ¼å¼æ‰§è¡Œç›¸åº”çš„å½’ä¸€åŒ–æ“ä½œã€‚

ç„¶åï¼Œå®šä¹‰äº†ä¸€ä¸ª `GRN` ç±»ï¼Œè¡¨ç¤ºå…¨å±€å“åº”å½’ä¸€åŒ–å±‚ã€‚è¿™ä¸ªå±‚é€šè¿‡è®¡ç®—è¾“å…¥çš„ L2 èŒƒæ•°æ¥è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¹¶é€šè¿‡å¯å­¦ä¹ çš„å‚æ•° `gamma` å’Œ `beta` æ¥è°ƒæ•´è¾“å‡ºã€‚

æ¥ä¸‹æ¥æ˜¯ `Block` ç±»ï¼Œå®ƒæ˜¯ ConvNeXtV2 æ¨¡å‹çš„åŸºæœ¬æ„å»ºå—ã€‚è¿™ä¸ªç±»åŒ…å«äº†æ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€å±‚å½’ä¸€åŒ–ã€ç‚¹å·ç§¯ã€æ¿€æ´»å‡½æ•°å’Œ GRNã€‚`forward` æ–¹æ³•å®ç°äº†æ•°æ®çš„å‰å‘ä¼ æ’­ï¼ŒåŒ…æ‹¬å¯¹è¾“å…¥çš„å·ç§¯æ“ä½œã€å½’ä¸€åŒ–ã€æ¿€æ´»å’Œæœ€ç»ˆçš„æ®‹å·®è¿æ¥ã€‚

`ConvNeXtV2` ç±»æ˜¯æ•´ä¸ªæ¨¡å‹çš„æ ¸å¿ƒï¼Œæ„é€ å‡½æ•°ä¸­å®šä¹‰äº†è¾“å…¥é€šé“æ•°ã€åˆ†ç±»ç±»åˆ«æ•°ã€æ¯ä¸ªé˜¶æ®µçš„å—æ•°ã€ç‰¹å¾ç»´åº¦ã€éšæœºæ·±åº¦ç‡ç­‰å‚æ•°ã€‚æ¨¡å‹çš„å‰åŠéƒ¨åˆ†ç”±ä¸€ä¸ª stem å±‚å’Œä¸‰ä¸ªä¸‹é‡‡æ ·å±‚ç»„æˆï¼ŒååŠéƒ¨åˆ†åˆ™æ˜¯å¤šä¸ªç‰¹å¾åˆ†è¾¨ç‡é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µç”±å¤šä¸ª `Block` ç»„æˆã€‚æ¨¡å‹çš„æœ€åä¸€å±‚æ˜¯ä¸€ä¸ªçº¿æ€§å±‚ï¼Œç”¨äºè¾“å‡ºåˆ†ç±»ç»“æœã€‚

åœ¨æ¨¡å‹åˆå§‹åŒ–æ—¶ï¼Œè°ƒç”¨ `_init_weights` æ–¹æ³•å¯¹å·ç§¯å±‚å’Œçº¿æ€§å±‚çš„æƒé‡è¿›è¡Œåˆå§‹åŒ–ã€‚`forward` æ–¹æ³•è´Ÿè´£å°†è¾“å…¥æ•°æ®é€šè¿‡ä¸‹é‡‡æ ·å±‚å’Œç‰¹å¾é˜¶æ®µè¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›ç‰¹å¾å›¾ã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶è¿˜å®šä¹‰äº†ä¸€ä¸ª `update_weight` å‡½æ•°ï¼Œç”¨äºæ›´æ–°æ¨¡å‹çš„æƒé‡ã€‚è¿™ä¸ªå‡½æ•°ä¼šæ£€æŸ¥æƒé‡å­—å…¸ä¸­çš„æ¯ä¸ªé”®æ˜¯å¦åœ¨æ¨¡å‹å­—å…¸ä¸­ï¼Œå¹¶ä¸”å½¢çŠ¶æ˜¯å¦åŒ¹é…ï¼ŒåŒ¹é…çš„æƒé‡ä¼šè¢«æ›´æ–°ã€‚

æœ€åï¼Œæ–‡ä»¶æä¾›äº†ä¸€ç³»åˆ—å‡½æ•°ï¼ˆå¦‚ `convnextv2_atto`ã€`convnextv2_femto` ç­‰ï¼‰ï¼Œç”¨äºåˆ›å»ºä¸åŒè§„æ¨¡çš„ ConvNeXtV2 æ¨¡å‹ã€‚è¿™äº›å‡½æ•°æ¥å—æƒé‡å‚æ•°ï¼Œå¹¶åœ¨åˆ›å»ºæ¨¡å‹ååŠ è½½ç›¸åº”çš„æƒé‡ã€‚

æ•´ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªçµæ´»ä¸”å¯æ‰©å±•çš„å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„ï¼Œé€‚ç”¨äºå„ç§å›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

Ultralytics YOLOæ¡†æ¶æ˜¯ä¸€ä¸ªç”¨äºç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œæä¾›äº†çµæ´»çš„æ¶æ„å’Œå¤šç§åŠŸèƒ½æ¨¡å—ã€‚è¯¥æ¡†æ¶çš„æ•´ä½“æ„æ¶åŒ…æ‹¬å¤šä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ï¼Œä¾¿äºæ¨¡å‹çš„è®­ç»ƒã€é¢„æµ‹å’Œå›è°ƒç®¡ç†ã€‚ä»¥ä¸‹æ˜¯å„ä¸ªæ¨¡å—çš„åŠŸèƒ½æ¦‚è¿°ï¼š

1. **Kernel Warehouse**ï¼šå®ç°äº†ä¸€ä¸ªå·ç§¯æ ¸ç®¡ç†æœºåˆ¶ï¼Œä¼˜åŒ–äº†å·ç§¯æ“ä½œä¸­çš„å‚æ•°ç®¡ç†å’Œè®¡ç®—æ•ˆç‡ï¼Œæ”¯æŒæ³¨æ„åŠ›æœºåˆ¶ã€‚
2. **å›è°ƒç®¡ç†**ï¼šæä¾›äº†çµæ´»çš„å›è°ƒæœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨è®­ç»ƒã€éªŒè¯ã€é¢„æµ‹å’Œå¯¼å‡ºè¿‡ç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œä»¥ä¾¿äºæ—¥å¿—è®°å½•å’Œå¯è§†åŒ–ã€‚
3. **å›¾åƒåˆ†å‰²é¢„æµ‹**ï¼šå®ç°äº†å›¾åƒåˆ†å‰²æ¨¡å‹çš„é¢„æµ‹åŠŸèƒ½ï¼Œå¤„ç†è¾“å…¥å›¾åƒå¹¶ç”Ÿæˆç›¸åº”çš„åˆ†å‰²ç»“æœã€‚
4. **DVCLiveé›†æˆ**ï¼šç”¨äºè®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ—¥å¿—å’Œå¯è§†åŒ–ï¼Œå¢å¼ºè®­ç»ƒè¿‡ç¨‹çš„å¯è¿½æº¯æ€§ã€‚
5. **ConvNeXtV2æ¨¡å‹**ï¼šå®ç°äº†ä¸€ä¸ªç”¨äºå›¾åƒåˆ†ç±»çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œæ„å»ºäº†å¤šå±‚æ¬¡çš„å·ç§¯å—å’Œå½’ä¸€åŒ–å±‚ï¼Œæ”¯æŒä¸åŒè§„æ¨¡çš„æ¨¡å‹åˆ›å»ºã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                         | åŠŸèƒ½æè¿°                                                                                     |
|--------------------------------------------------|----------------------------------------------------------------------------------------------|
| `ultralytics\nn\extra_modules\kernel_warehouse.py` | å®ç°å·ç§¯æ ¸ç®¡ç†æœºåˆ¶ï¼Œä¼˜åŒ–å·ç§¯æ“ä½œä¸­çš„å‚æ•°ç®¡ç†å’Œè®¡ç®—æ•ˆç‡ï¼Œæ”¯æŒæ³¨æ„åŠ›æœºåˆ¶ã€‚                     |
| `ultralytics\utils\callbacks\base.py`           | å®šä¹‰å›è°ƒå‡½æ•°çš„åŸºç¡€æ¨¡å—ï¼Œå…è®¸åœ¨è®­ç»ƒã€éªŒè¯ã€é¢„æµ‹å’Œå¯¼å‡ºè¿‡ç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚                  |
| `ultralytics\models\yolo\segment\predict.py`    | å®ç°å›¾åƒåˆ†å‰²æ¨¡å‹çš„é¢„æµ‹åŠŸèƒ½ï¼Œå¤„ç†è¾“å…¥å›¾åƒå¹¶ç”Ÿæˆç›¸åº”çš„åˆ†å‰²ç»“æœã€‚                              |
| `ultralytics\utils\callbacks\dvc.py`            | é›†æˆDVCLiveè¿›è¡Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„æ—¥å¿—è®°å½•å’Œå¯è§†åŒ–ï¼Œå¢å¼ºè®­ç»ƒè¿‡ç¨‹çš„å¯è¿½æº¯æ€§ã€‚                      |
| `ultralytics\nn\backbone\convnextv2.py`        | å®ç°ConvNeXtV2å›¾åƒåˆ†ç±»æ¨¡å‹ï¼Œæ„å»ºå¤šå±‚æ¬¡çš„å·ç§¯å—å’Œå½’ä¸€åŒ–å±‚ï¼Œæ”¯æŒä¸åŒè§„æ¨¡çš„æ¨¡å‹åˆ›å»ºã€‚         |

ä»¥ä¸Šè¡¨æ ¼æ€»ç»“äº†æ¯ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå±•ç¤ºäº†Ultralytics YOLOæ¡†æ¶çš„æ¨¡å—åŒ–è®¾è®¡å’Œçµæ´»æ€§ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ50+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ14.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+50+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å›¾ç‰‡ã€è§†é¢‘ã€æ‘„åƒå¤´å›¾åƒåˆ†å‰²Demo(å»é™¤WebUI)ä»£ç 

åœ¨è¿™ä¸ªåšå®¢å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨ä¸ä½¿ç”¨WebUIçš„æƒ…å†µä¸‹ï¼Œå®ç°å›¾åƒåˆ†å‰²æ¨¡å‹çš„ä½¿ç”¨ã€‚æœ¬é¡¹ç›®ä»£ç å·²ç»ä¼˜åŒ–æ•´åˆï¼Œæ–¹ä¾¿ç”¨æˆ·å°†åˆ†å‰²åŠŸèƒ½åµŒå…¥è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚
æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ã€æ‘„åƒå¤´å›¾åƒçš„åˆ†å‰²ï¼ŒROIåŒºåŸŸçš„è½®å»“æå–ã€ç±»åˆ«åˆ†ç±»ã€å‘¨é•¿è®¡ç®—ã€é¢ç§¯è®¡ç®—ã€åœ†åº¦è®¡ç®—ä»¥åŠé¢œè‰²æå–ç­‰ã€‚
è¿™äº›åŠŸèƒ½æä¾›äº†è‰¯å¥½çš„äºŒæ¬¡å¼€å‘åŸºç¡€ã€‚

### æ ¸å¿ƒä»£ç è§£è¯»

ä»¥ä¸‹æ˜¯ä¸»è¦ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬ä¼šä¸ºæ¯ä¸€å—ä»£ç è¿›è¡Œè¯¦ç»†çš„æ‰¹æ³¨è§£é‡Šï¼š

```python
import random
import cv2
import numpy as np
from PIL import ImageFont, ImageDraw, Image
from hashlib import md5
from model import Web_Detector
from chinese_name_list import Label_list

# æ ¹æ®åç§°ç”Ÿæˆé¢œè‰²
def generate_color_based_on_name(name):
    ......

# è®¡ç®—å¤šè¾¹å½¢é¢ç§¯
def calculate_polygon_area(points):
    return cv2.contourArea(points.astype(np.float32))

...
# ç»˜åˆ¶ä¸­æ–‡æ ‡ç­¾
def draw_with_chinese(image, text, position, font_size=20, color=(255, 0, 0)):
    image_pil = Image.fromarray(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    draw = ImageDraw.Draw(image_pil)
    font = ImageFont.truetype("simsun.ttc", font_size, encoding="unic")
    draw.text(position, text, font=font, fill=color)
    return cv2.cvtColor(np.array(image_pil), cv2.COLOR_RGB2BGR)

# åŠ¨æ€è°ƒæ•´å‚æ•°
def adjust_parameter(image_size, base_size=1000):
    max_size = max(image_size)
    return max_size / base_size

# ç»˜åˆ¶æ£€æµ‹ç»“æœ
def draw_detections(image, info, alpha=0.2):
    name, bbox, conf, cls_id, mask = info['class_name'], info['bbox'], info['score'], info['class_id'], info['mask']
    adjust_param = adjust_parameter(image.shape[:2])
    spacing = int(20 * adjust_param)

    if mask is None:
        x1, y1, x2, y2 = bbox
        aim_frame_area = (x2 - x1) * (y2 - y1)
        cv2.rectangle(image, (x1, y1), (x2, y2), color=(0, 0, 255), thickness=int(3 * adjust_param))
        image = draw_with_chinese(image, name, (x1, y1 - int(30 * adjust_param)), font_size=int(35 * adjust_param))
        y_offset = int(50 * adjust_param)  # ç±»åˆ«åç§°ä¸Šæ–¹ç»˜åˆ¶ï¼Œå…¶ä¸‹æ–¹ç•™å‡ºç©ºé—´
    else:
        mask_points = np.concatenate(mask)
        aim_frame_area = calculate_polygon_area(mask_points)
        mask_color = generate_color_based_on_name(name)
        try:
            overlay = image.copy()
            cv2.fillPoly(overlay, [mask_points.astype(np.int32)], mask_color)
            image = cv2.addWeighted(overlay, 0.3, image, 0.7, 0)
            cv2.drawContours(image, [mask_points.astype(np.int32)], -1, (0, 0, 255), thickness=int(8 * adjust_param))

            # è®¡ç®—é¢ç§¯ã€å‘¨é•¿ã€åœ†åº¦
            area = cv2.contourArea(mask_points.astype(np.int32))
            perimeter = cv2.arcLength(mask_points.astype(np.int32), True)
            ......

            # è®¡ç®—è‰²å½©
            mask = np.zeros(image.shape[:2], dtype=np.uint8)
            cv2.drawContours(mask, [mask_points.astype(np.int32)], -1, 255, -1)
            color_points = cv2.findNonZero(mask)
            ......

            # ç»˜åˆ¶ç±»åˆ«åç§°
            x, y = np.min(mask_points, axis=0).astype(int)
            image = draw_with_chinese(image, name, (x, y - int(30 * adjust_param)), font_size=int(35 * adjust_param))
            y_offset = int(50 * adjust_param)

            # ç»˜åˆ¶é¢ç§¯ã€å‘¨é•¿ã€åœ†åº¦å’Œè‰²å½©å€¼
            metrics = [("Area", area), ("Perimeter", perimeter), ("Circularity", circularity), ("Color", color_str)]
            for idx, (metric_name, metric_value) in enumerate(metrics):
                ......

    return image, aim_frame_area

# å¤„ç†æ¯å¸§å›¾åƒ
def process_frame(model, image):
    pre_img = model.preprocess(image)
    pred = model.predict(pre_img)
    det = pred[0] if det is not None and len(det)
    if det:
        det_info = model.postprocess(pred)
        for info in det_info:
            image, _ = draw_detections(image, info)
    return image

if __name__ == "__main__":
    cls_name = Label_list
    model = Web_Detector()
    model.load_model("./weights/yolov8s-seg.pt")

    # æ‘„åƒå¤´å®æ—¶å¤„ç†
    cap = cv2.VideoCapture(0)
    while cap.isOpened():
        ret, frame = cap.read()
        if not ret:
            break
        ......

    # å›¾ç‰‡å¤„ç†
    image_path = './icon/OIP.jpg'
    image = cv2.imread(image_path)
    if image is not None:
        processed_image = process_frame(model, image)
        ......

    # è§†é¢‘å¤„ç†
    video_path = ''  # è¾“å…¥è§†é¢‘çš„è·¯å¾„
    cap = cv2.VideoCapture(video_path)
    while cap.isOpened():
        ret, frame = cap.read()
        ......
```


### 14.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+50+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/Z5WalJhv](https://mbd.pub/o/bread/Z5WalJhv)